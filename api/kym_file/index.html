
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kymograph blood flow analysis tool">
      
      
        <meta name="author" content="Robert H. Cudmore">
      
      
      
        <link rel="prev" href="../../user-guide/batch-processing/">
      
      
        <link rel="next" href="../kym_flow_radon_gpt/">
      
      
        
      
      
      <link rel="icon" href="../../images/kymflow.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>kymflow_core.kym_file - KymFlow</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../theme/css/style.css">
    
      <link rel="stylesheet" href="../../theme/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kymflow_corekym_file" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KymFlow" class="md-header__button md-logo" aria-label="KymFlow" data-md-component="logo">
      
  <img src="../../images/kymflow.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KymFlow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              kymflow_core.kym_file
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mapmanager/kymflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    KymFlow Repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KymFlow" class="md-nav__button md-logo" aria-label="KymFlow" data-md-component="logo">
      
  <img src="../../images/kymflow.png" alt="logo">

    </a>
    KymFlow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mapmanager/kymflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    KymFlow Repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Download
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/gui-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GUI Usage
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/batch-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch Processing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    kymflow_core.kym_file
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    kymflow_core.kym_file
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        kym_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.AnalysisParameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnalysisParameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.ExperimentMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        ExperimentMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.FieldMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.KymFile" class="md-nav__link">
    <span class="md-ellipsis">
      
        KymFile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.OlympusHeader" class="md-nav__link">
    <span class="md-ellipsis">
      
        OlympusHeader
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.collect_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        collect_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.field_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        field_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.iter_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter_metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kym_flow_radon_gpt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kymflow_core.kym_flow_radon_gpt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repository/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kymflow_core.repository
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kymflow_core.state
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        kym_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.AnalysisParameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnalysisParameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.ExperimentMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        ExperimentMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.FieldMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.KymFile" class="md-nav__link">
    <span class="md-ellipsis">
      
        KymFile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.OlympusHeader" class="md-nav__link">
    <span class="md-ellipsis">
      
        OlympusHeader
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kymflow_core.kym_file-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.collect_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        collect_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.field_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        field_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kymflow_core.kym_file.iter_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter_metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="kymflow_corekym_file">kymflow_core.kym_file<a class="headerlink" href="#kymflow_corekym_file" title="Permanent link">¤</a></h1>


<div class="doc doc-object doc-module">



<a id="kymflow_core.kym_file"></a>
    <div class="doc doc-contents first">

        <p>High-level API for working with kymograph TIFF files.</p>
<p>This module provides the core data structures and functionality for loading,
managing, and analyzing kymograph files. The main entry point is the <code>KymFile</code>
class, which encapsulates raw image data, microscope metadata (Olympus txt),
experimental metadata, and analysis products.</p>
<p>The module is designed to support lazy loading - metadata queries do not require
loading full TIFF data, making it efficient for browsing large collections of
files. Analysis algorithms are pluggable through a consistent interface.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>Basic usage for loading and analyzing a kymograph file:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kymflow_core.kym_file</span><span class="w"> </span><span class="kn">import</span> <span class="n">KymFile</span>

<span class="n">kym</span> <span class="o">=</span> <span class="n">KymFile</span><span class="p">(</span><span class="s2">&quot;/path/to/file.tif&quot;</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">kym</span><span class="o">.</span><span class="n">to_metadata_dict</span><span class="p">(</span><span class="n">include_analysis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">kym</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>
<span class="n">kym</span><span class="o">.</span><span class="n">analyze_flow</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</code></pre></div>
</details>









  <div class="doc doc-children">







<h2 id="kymflow_core.kym_file-classes">Classes<a href="#kymflow_core.kym_file-classes" class="headerlink" title="Permanent link">¤</a></h2>

<div class="doc doc-object doc-class">



<h3 id="kymflow_core.kym_file.AnalysisParameters" class="doc doc-heading">
            <code>AnalysisParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#kymflow_core.kym_file.AnalysisParameters" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">



        <p>Metadata describing analysis parameters and results.</p>
<p>Stores information about the analysis algorithm used, its parameters,
when it was run, and where results are saved. This metadata is saved
alongside analysis results for reproducibility.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.AnalysisParameters.algorithm">algorithm</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the analysis algorithm (e.g., "mpRadon").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.AnalysisParameters.parameters">parameters</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of algorithm-specific parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.AnalysisParameters.analyzed_at">analyzed_at</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timestamp when analysis was performed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.AnalysisParameters.result_path">result_path</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the saved analysis results file (CSV).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnalysisParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata describing analysis parameters and results.</span>

<span class="sd">    Stores information about the analysis algorithm used, its parameters,</span>
<span class="sd">    when it was run, and where results are saved. This metadata is saved</span>
<span class="sd">    alongside analysis results for reproducibility.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        algorithm: Name of the analysis algorithm (e.g., &quot;mpRadon&quot;).</span>
<span class="sd">        parameters: Dictionary of algorithm-specific parameters.</span>
<span class="sd">        analyzed_at: Timestamp when analysis was performed.</span>
<span class="sd">        result_path: Path to the saved analysis results file (CSV).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Algorithm&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Parameters&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">analyzed_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analyzed At&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">result_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Result Path&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary for serialization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with all analysis parameters. Datetime is converted to</span>
<span class="sd">            ISO format string, and Path is converted to string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="s2">&quot;analyzed_at&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzed_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzed_at</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_path</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_path</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">        Generates a list of field definitions with metadata extracted from</span>
<span class="sd">        the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">        generate forms without hardcoding field information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">            widget type, grid span, visibility, and field type information.</span>
<span class="sd">            Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                    <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># Order is determined by the order of the fields in the dataclass</span>
        <span class="k">return</span> <span class="n">schema</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="kymflow_core.kym_file.AnalysisParameters-functions">Functions<a href="#kymflow_core.kym_file.AnalysisParameters-functions" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.AnalysisParameters.form_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_schema</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.AnalysisParameters.form_schema" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Return field schema for form generation.</p>
<p>Generates a list of field definitions with metadata extracted from
the dataclass field definitions. Used by GUI frameworks to dynamically
generate forms without hardcoding field information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries, each containing field name, label, editability,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>widget type, grid span, visibility, and field type information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fields are ordered by their declaration order in the dataclass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">    Generates a list of field definitions with metadata extracted from</span>
<span class="sd">    the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">    generate forms without hardcoding field information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">        widget type, grid span, visibility, and field type information.</span>
<span class="sd">        Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># Order is determined by the order of the fields in the dataclass</span>
    <span class="k">return</span> <span class="n">schema</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.AnalysisParameters.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.AnalysisParameters.to_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Convert to dictionary for serialization.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with all analysis parameters. Datetime is converted to</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ISO format string, and Path is converted to string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dictionary for serialization.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with all analysis parameters. Datetime is converted to</span>
<span class="sd">        ISO format string, and Path is converted to string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="s2">&quot;analyzed_at&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzed_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzed_at</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;result_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_path</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_path</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kymflow_core.kym_file.ExperimentMetadata" class="doc doc-heading">
            <code>ExperimentMetadata</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#kymflow_core.kym_file.ExperimentMetadata" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">



        <p>User-provided experimental metadata for kymograph files.</p>
<p>Contains structured fields for documenting experimental conditions,
sample information, and notes. All fields are optional and have default
values. Unknown keys in dictionaries are silently ignored when loading
from dict to maintain strict schema validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.species">species</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Animal species (e.g., "mouse", "rat").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.region">region</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Brain region or anatomical location.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.cell_type">cell_type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of cell or vessel being imaged.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.depth">depth</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Imaging depth in micrometers.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.branch_order">branch_order</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Branch order for vascular structures.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.direction">direction</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flow direction or vessel orientation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.sex">sex</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Animal sex.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.genotype">genotype</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Genetic background or modification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.condition">condition</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Experimental condition or treatment.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.acquisition_date">acquisition_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date of acquisition (read-only, from header).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.acquisition_time">acquisition_time</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of acquisition (read-only, from header).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.ExperimentMetadata.note">note</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Free-form notes or comments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExperimentMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;User-provided experimental metadata for kymograph files.</span>

<span class="sd">    Contains structured fields for documenting experimental conditions,</span>
<span class="sd">    sample information, and notes. All fields are optional and have default</span>
<span class="sd">    values. Unknown keys in dictionaries are silently ignored when loading</span>
<span class="sd">    from dict to maintain strict schema validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        species: Animal species (e.g., &quot;mouse&quot;, &quot;rat&quot;).</span>
<span class="sd">        region: Brain region or anatomical location.</span>
<span class="sd">        cell_type: Type of cell or vessel being imaged.</span>
<span class="sd">        depth: Imaging depth in micrometers.</span>
<span class="sd">        branch_order: Branch order for vascular structures.</span>
<span class="sd">        direction: Flow direction or vessel orientation.</span>
<span class="sd">        sex: Animal sex.</span>
<span class="sd">        genotype: Genetic background or modification.</span>
<span class="sd">        condition: Experimental condition or treatment.</span>
<span class="sd">        acquisition_date: Date of acquisition (read-only, from header).</span>
<span class="sd">        acquisition_time: Time of acquisition (read-only, from header).</span>
<span class="sd">        note: Free-form notes or comments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Species&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cell_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cell type&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">depth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Depth&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">branch_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Branch order&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Direction&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">sex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">genotype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Genotype&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Condition&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">acquisition_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Acquisition Date&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">acquisition_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Acquisition Time&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">note</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ExperimentMetadata&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create instance from dictionary, ignoring unknown keys.</span>

<span class="sd">        Only fields defined in the dataclass are extracted from the payload.</span>
<span class="sd">        Unknown keys are silently ignored to maintain strict schema validation.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload: Dictionary containing metadata fields. Can be None or empty.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ExperimentMetadata instance with values from payload, or defaults</span>
<span class="sd">            if payload is None or empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">init</span><span class="p">}</span>
        <span class="n">known</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">valid</span><span class="p">}</span>
        <span class="c1"># Unknown keys are silently ignored (strict schema-only strategy)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">known</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary with standardized key names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with field values, using abbreviated keys (acq_date,</span>
<span class="sd">            acq_time) for compatibility with external APIs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
            <span class="s2">&quot;cell_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
            <span class="s2">&quot;sex&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sex</span><span class="p">,</span>
            <span class="s2">&quot;genotype&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">,</span>
            <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
            <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">note</span><span class="p">,</span>
            <span class="s2">&quot;acq_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition_date</span><span class="p">,</span>
            <span class="s2">&quot;acq_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition_time</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">        Generates a list of field definitions with metadata extracted from</span>
<span class="sd">        the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">        generate forms without hardcoding field information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">            widget type, grid span, visibility, and field type information.</span>
<span class="sd">            Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                    <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># order is determined by the order of the fields in the dataclass</span>
        <span class="c1"># # Sort by order</span>
        <span class="c1"># schema.sort(key=lambda x: x[&quot;order&quot;])</span>
        <span class="k">return</span> <span class="n">schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_editable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current values for editable fields only.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping field names to string representations of their</span>
<span class="sd">            current values. Only includes fields marked as editable in the</span>
<span class="sd">            form schema. None values are converted to empty strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;editable&quot;</span><span class="p">]:</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="kymflow_core.kym_file.ExperimentMetadata-functions">Functions<a href="#kymflow_core.kym_file.ExperimentMetadata-functions" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.ExperimentMetadata.form_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_schema</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.ExperimentMetadata.form_schema" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Return field schema for form generation.</p>
<p>Generates a list of field definitions with metadata extracted from
the dataclass field definitions. Used by GUI frameworks to dynamically
generate forms without hardcoding field information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries, each containing field name, label, editability,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>widget type, grid span, visibility, and field type information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fields are ordered by their declaration order in the dataclass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">    Generates a list of field definitions with metadata extracted from</span>
<span class="sd">    the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">    generate forms without hardcoding field information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">        widget type, grid span, visibility, and field type information.</span>
<span class="sd">        Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># order is determined by the order of the fields in the dataclass</span>
    <span class="c1"># # Sort by order</span>
    <span class="c1"># schema.sort(key=lambda x: x[&quot;order&quot;])</span>
    <span class="k">return</span> <span class="n">schema</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.ExperimentMetadata.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.ExperimentMetadata.from_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Create instance from dictionary, ignoring unknown keys.</p>
<p>Only fields defined in the dataclass are extracted from the payload.
Unknown keys are silently ignored to maintain strict schema validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing metadata fields. Can be None or empty.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;ExperimentMetadata&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ExperimentMetadata instance with values from payload, or defaults</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;ExperimentMetadata&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if payload is None or empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ExperimentMetadata&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create instance from dictionary, ignoring unknown keys.</span>

<span class="sd">    Only fields defined in the dataclass are extracted from the payload.</span>
<span class="sd">    Unknown keys are silently ignored to maintain strict schema validation.</span>

<span class="sd">    Args:</span>
<span class="sd">        payload: Dictionary containing metadata fields. Can be None or empty.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ExperimentMetadata instance with values from payload, or defaults</span>
<span class="sd">        if payload is None or empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">init</span><span class="p">}</span>
    <span class="n">known</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">valid</span><span class="p">}</span>
    <span class="c1"># Unknown keys are silently ignored (strict schema-only strategy)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">known</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.ExperimentMetadata.get_editable_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_editable_values</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.ExperimentMetadata.get_editable_values" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Get current values for editable fields only.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping field names to string representations of their</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current values. Only includes fields marked as editable in the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>form schema. None values are converted to empty strings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_editable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current values for editable fields only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping field names to string representations of their</span>
<span class="sd">        current values. Only includes fields marked as editable in the</span>
<span class="sd">        form schema. None values are converted to empty strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;editable&quot;</span><span class="p">]:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.ExperimentMetadata.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.ExperimentMetadata.to_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Convert to dictionary with standardized key names.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with field values, using abbreviated keys (acq_date,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>acq_time) for compatibility with external APIs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dictionary with standardized key names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with field values, using abbreviated keys (acq_date,</span>
<span class="sd">        acq_time) for compatibility with external APIs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;species&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="s2">&quot;cell_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
        <span class="s2">&quot;sex&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sex</span><span class="p">,</span>
        <span class="s2">&quot;genotype&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">,</span>
        <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
        <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">note</span><span class="p">,</span>
        <span class="s2">&quot;acq_date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition_date</span><span class="p">,</span>
        <span class="s2">&quot;acq_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition_time</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kymflow_core.kym_file.FieldMetadata" class="doc doc-heading">
            <code>FieldMetadata</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#kymflow_core.kym_file.FieldMetadata" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">



        <p>Structured metadata for form field definitions.</p>
<p>Provides type-safe field metadata to avoid typos in metadata dictionaries.
Used by GUI forms to configure field visibility, editability, and layout.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.editable">editable</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the field can be edited by the user.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.label">label</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display label for the field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.widget_type">widget_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of widget to use (e.g., "text", "number").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.grid_span">grid_span</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of grid columns this field spans.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.order">order</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional ordering value for field display.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.FieldMetadata.visible">visible</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the field should be visible in forms.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FieldMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured metadata for form field definitions.</span>

<span class="sd">    Provides type-safe field metadata to avoid typos in metadata dictionaries.</span>
<span class="sd">    Used by GUI forms to configure field visibility, editability, and layout.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        editable: Whether the field can be edited by the user.</span>
<span class="sd">        label: Display label for the field.</span>
<span class="sd">        widget_type: Type of widget to use (e.g., &quot;text&quot;, &quot;number&quot;).</span>
<span class="sd">        grid_span: Number of grid columns this field spans.</span>
<span class="sd">        order: Optional ordering value for field display.</span>
<span class="sd">        visible: Whether the field should be visible in forms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">editable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">widget_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">grid_span</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary for use in field(metadata=...).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing all field metadata attributes, with None</span>
<span class="sd">            values for order omitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_type</span><span class="p">,</span>
            <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_span</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="kymflow_core.kym_file.FieldMetadata-functions">Functions<a href="#kymflow_core.kym_file.FieldMetadata-functions" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.FieldMetadata.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.FieldMetadata.to_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Convert to dictionary for use in field(metadata=...).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing all field metadata attributes, with None</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>values for order omitted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dictionary for use in field(metadata=...).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing all field metadata attributes, with None</span>
<span class="sd">        values for order omitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
        <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_type</span><span class="p">,</span>
        <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_span</span><span class="p">,</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kymflow_core.kym_file.KymFile" class="doc doc-heading">
            <code>KymFile</code>


<a href="#kymflow_core.kym_file.KymFile" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">



        <p>Encapsulates a kymograph TIFF file with metadata and analysis.</p>
<p>This class provides a unified interface for working with kymograph files,
including lazy loading of image data, metadata management, and flow analysis.
The class is designed to support efficient metadata-only workflows where
full image data is not needed.</p>
<p>Always use KymFile properties and methods rather than accessing internal
data structures directly. Key properties include:</p>
<ul>
<li><code>duration_seconds</code>: Total recording duration in seconds</li>
<li><code>pixels_per_line</code>: Number of pixels per line (spatial dimension)</li>
<li><code>num_lines</code>: Number of lines (time dimension)</li>
<li><code>acquisition_metadata</code>: OlympusHeader with metadata (seconds_per_line, um_per_pixel, etc.)</li>
<li><code>ensure_image_loaded()</code>: Load and return the image array</li>
</ul>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.KymFile.path">path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the TIFF file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.KymFile.experiment_metadata">experiment_metadata</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExperimentMetadata


  
      dataclass
   (kymflow_core.kym_file.ExperimentMetadata)" href="#kymflow_core.kym_file.ExperimentMetadata">ExperimentMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User-provided experimental metadata.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.KymFile.acquisition_metadata">acquisition_metadata</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="OlympusHeader


  
      dataclass
   (kymflow_core.kym_file.OlympusHeader)" href="#kymflow_core.kym_file.OlympusHeader">OlympusHeader</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Olympus microscope header data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.KymFile.analysis_parameters">analysis_parameters</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="AnalysisParameters


  
      dataclass
   (kymflow_core.kym_file.AnalysisParameters)" href="#kymflow_core.kym_file.AnalysisParameters">AnalysisParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters and results from flow analysis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="n">kym</span> <span class="o">=</span> <span class="n">KymFile</span><span class="p">(</span><span class="s2">&quot;file.tif&quot;</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">kym</span><span class="o">.</span><span class="n">duration_seconds</span>
<span class="n">pixels</span> <span class="o">=</span> <span class="n">kym</span><span class="o">.</span><span class="n">pixels_per_line</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">kym</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>
</code></pre></div>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KymFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates a kymograph TIFF file with metadata and analysis.</span>

<span class="sd">    This class provides a unified interface for working with kymograph files,</span>
<span class="sd">    including lazy loading of image data, metadata management, and flow analysis.</span>
<span class="sd">    The class is designed to support efficient metadata-only workflows where</span>
<span class="sd">    full image data is not needed.</span>

<span class="sd">    Always use KymFile properties and methods rather than accessing internal</span>
<span class="sd">    data structures directly. Key properties include:</span>

<span class="sd">    - `duration_seconds`: Total recording duration in seconds</span>
<span class="sd">    - `pixels_per_line`: Number of pixels per line (spatial dimension)</span>
<span class="sd">    - `num_lines`: Number of lines (time dimension)</span>
<span class="sd">    - `acquisition_metadata`: OlympusHeader with metadata (seconds_per_line, um_per_pixel, etc.)</span>
<span class="sd">    - `ensure_image_loaded()`: Load and return the image array</span>

<span class="sd">    Attributes:</span>
<span class="sd">        path: Path to the TIFF file.</span>
<span class="sd">        experiment_metadata: User-provided experimental metadata.</span>
<span class="sd">        acquisition_metadata: Olympus microscope header data.</span>
<span class="sd">        analysis_parameters: Parameters and results from flow analysis.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        kym = KymFile(&quot;file.tif&quot;, load_image=False)</span>
<span class="sd">        duration = kym.duration_seconds</span>
<span class="sd">        pixels = kym.pixels_per_line</span>
<span class="sd">        image = kym.ensure_image_loaded()</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize KymFile instance.</span>

<span class="sd">        Loads metadata from the TIFF file and accompanying Olympus header file</span>
<span class="sd">        if available. Optionally loads the image data immediately if requested.</span>
<span class="sd">        Analysis data is automatically loaded if available.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Path to the kymograph TIFF file.</span>
<span class="sd">            load_image: If True, load the TIFF image data immediately. If False,</span>
<span class="sd">                image will be loaded lazily when needed. Defaults to False for</span>
<span class="sd">                efficient metadata-only workflows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">:</span> <span class="n">ExperimentMetadata</span> <span class="o">=</span> <span class="n">ExperimentMetadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">:</span> <span class="n">OlympusHeader</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="p">()</span>  <span class="c1"># header is default values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="p">:</span> <span class="n">AnalysisParameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># full df loaded from csv file</span>

        <span class="c1"># try and load Olympus header from txt file if it exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="o">.</span><span class="n">from_tif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_analysis</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">load_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;KymFile(filename: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">summary_row</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate tabular summary for file list views.</span>

<span class="sd">        Returns a dictionary with key metadata fields formatted for display</span>
<span class="sd">        in table views. Includes file name, folder hierarchy, analysis status,</span>
<span class="sd">        and key acquisition parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with keys suitable for table display, including file</span>
<span class="sd">            name, folder names, analysis status, and metadata values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;File Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;Parent Folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;Grandparent Folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;Analyzed&quot;</span><span class="p">:</span> <span class="s2">&quot;✓&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisExists</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Saved&quot;</span><span class="p">:</span> <span class="s2">&quot;✓&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Window Points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;window_size&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;pixels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_line</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_lines</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;duration (s)&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ms/line&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span>
            <span class="k">else</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;um/pixel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">um_per_pixel</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bits/pixel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">bits_per_pixel</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_metadata</span><span class="o">.</span><span class="n">note</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>  <span class="c1"># special case, not in any shema</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">table_column_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return column visibility schema for table display.</span>

<span class="sd">        Generates a dictionary mapping column names from summary_row() to</span>
<span class="sd">        visibility flags. Reuses existing form schemas where possible to</span>
<span class="sd">        avoid duplication of visibility rules.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping column names to boolean visibility flags.</span>
<span class="sd">            Columns not in the mapping default to visible=True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Mapping from summary_row keys to (dataclass_class, field_name) for schema lookup</span>
        <span class="c1"># Keys not in this mapping are derived/computed fields</span>
        <span class="n">schema_field_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ExperimentMetadata</span><span class="p">,</span> <span class="s2">&quot;note&quot;</span><span class="p">),</span>
            <span class="s2">&quot;um/pixel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">OlympusHeader</span><span class="p">,</span> <span class="s2">&quot;um_per_pixel&quot;</span><span class="p">),</span>
            <span class="c1"># &quot;pixels&quot;, &quot;lines&quot;, &quot;duration (s)&quot;, &quot;ms/line&quot; are derived from OlympusHeader</span>
            <span class="c1"># but with different names, so we&#39;d need property mappings - keeping simple for now</span>
        <span class="p">}</span>

        <span class="c1"># Override dict for columns not in any schema (derived/computed fields)</span>
        <span class="c1"># Defaults to True if not specified</span>
        <span class="n">visibility_overrides</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Always hide - used as row_key only</span>
            <span class="c1"># All other columns default to visible=True (don&#39;t need to list them)</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Look up visibility from existing form schemas</span>
        <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="p">(</span><span class="n">dataclass_cls</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">schema_field_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">form_schema</span> <span class="o">=</span> <span class="n">dataclass_cls</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">form_schema</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">field_name</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="c1"># Apply overrides (takes precedence)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">visibility_overrides</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Loading helpers</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ensure_header_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OlympusHeader</span><span class="p">:</span>
        <span class="c1"># header is always created in __init__</span>
        <span class="c1"># so we don&#39;t need to check if it is None</span>
        <span class="c1"># if self._header is None:</span>
        <span class="c1">#     self._header = OlympusHeader.from_tif(self.path)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ensure_image_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and return the kymograph image data.</span>

<span class="sd">        Implements lazy loading - the image is only loaded from disk when</span>
<span class="sd">        this method is called. Subsequent calls return the cached image.</span>
<span class="sd">        The image is flipped horizontally to match the expected orientation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            2D numpy array with shape (time, space) where axis 0 is time</span>
<span class="sd">            (line scans) and axis 1 is space (pixels).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># abb 20251121</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># logger.info(f&#39;image loaded: {self._image.shape} dtype:{self._image.dtype}&#39;)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Metadata exposure</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># abb not used</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_metadata_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_analysis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge all metadata into a single dictionary.</span>

<span class="sd">        Combines Olympus header data, experimental metadata, and optionally</span>
<span class="sd">        analysis parameters into a unified dictionary structure. This is the</span>
<span class="sd">        primary format consumed by GUI tables and CLI scripts.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_analysis: If True, include analysis parameters in the</span>
<span class="sd">                output. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing path, filename, and all metadata fields</span>
<span class="sd">            from header, experiment metadata, and optionally analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># header is always loaded in __init__ (can be default)</span>
        <span class="n">merged</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="c1"># &quot;filesize_bytes&quot;: self.path.stat().st_size if self.path.exists() else None,</span>
        <span class="p">}</span>
        <span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">include_analysis</span><span class="p">:</span>
            <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">merged</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentMetadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">acquisition_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OlympusHeader</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysis_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalysisParameters</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_experiment_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update stored experimental metadata fields.</span>

<span class="sd">        Updates one or more fields in the experiment metadata. Unknown fields</span>
<span class="sd">        are silently ignored. Marks the file as dirty (needs saving).</span>

<span class="sd">        Args:</span>
<span class="sd">            **fields: Keyword arguments mapping field names to new values.</span>
<span class="sd">                Only fields that exist in ExperimentMetadata are updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fields:</span><span class="si">{</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="c1"># Unknown keys are silently ignored (strict schema-only strategy)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Analysis hooks</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>  <span class="c1"># boundary between positional and keyword-only arguments</span>
        <span class="n">start_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProgressCallback</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_cancelled</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CancelCallback</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_multiprocessing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run Radon-based flow analysis on the kymograph.</span>

<span class="sd">        Performs a sliding window analysis along the time axis using Radon</span>
<span class="sd">        transforms to detect flow direction and velocity. Results are stored</span>
<span class="sd">        internally and can be saved using save_analysis(). The image must</span>
<span class="sd">        be loaded before calling this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            window_size: Number of time lines per analysis window. Must be</span>
<span class="sd">                a multiple of 4.</span>
<span class="sd">            start_pixel: Start index in space dimension (inclusive). If None,</span>
<span class="sd">                uses 0.</span>
<span class="sd">            stop_pixel: Stop index in space dimension (exclusive). If None,</span>
<span class="sd">                uses full width.</span>
<span class="sd">            progress_callback: Optional callback function(completed, total)</span>
<span class="sd">                called periodically to report progress.</span>
<span class="sd">            is_cancelled: Optional callback function() -&gt; bool that returns</span>
<span class="sd">                True if analysis should be cancelled.</span>
<span class="sd">            use_multiprocessing: If True, use multiprocessing for parallel</span>
<span class="sd">                computation. Defaults to True.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If window_size is invalid or data dimensions are</span>
<span class="sd">                incompatible.</span>
<span class="sd">            FlowCancelled: If analysis is cancelled via is_cancelled callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>

        <span class="n">thetas</span><span class="p">,</span> <span class="n">the_t</span><span class="p">,</span> <span class="n">spread</span> <span class="o">=</span> <span class="n">mp_analyze_flow</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">window_size</span><span class="p">,</span>
            <span class="n">start_pixel</span><span class="o">=</span><span class="n">start_pixel</span><span class="p">,</span>
            <span class="n">stop_pixel</span><span class="o">=</span><span class="n">stop_pixel</span><span class="p">,</span>
            <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
            <span class="n">is_cancelled</span><span class="o">=</span><span class="n">is_cancelled</span><span class="p">,</span>
            <span class="n">use_multiprocessing</span><span class="o">=</span><span class="n">use_multiprocessing</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Store lightweight metadata for UI access.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">(</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;mpRadon&quot;</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="n">window_size</span><span class="p">,</span>
                <span class="s2">&quot;start_pixel&quot;</span><span class="p">:</span> <span class="n">start_pixel</span><span class="p">,</span>
                <span class="s2">&quot;stop_pixel&quot;</span><span class="p">:</span> <span class="n">stop_pixel</span><span class="p">,</span>
                <span class="s2">&quot;use_multiprocessing&quot;</span><span class="p">:</span> <span class="n">use_multiprocessing</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">analyzed_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">secondsPerLine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span>
        <span class="n">umPerPixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">um_per_pixel</span>

        <span class="c1"># convert to physical units</span>
        <span class="n">drewTime</span> <span class="o">=</span> <span class="n">the_t</span> <span class="o">*</span> <span class="n">secondsPerLine</span>

        <span class="c1"># convert radians to angle</span>
        <span class="n">_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span>
        <span class="n">drewVelocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">umPerPixel</span> <span class="o">/</span> <span class="n">secondsPerLine</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_rad</span><span class="p">)</span>
        <span class="n">drewVelocity</span> <span class="o">=</span> <span class="n">drewVelocity</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># mm/s</span>

        <span class="c1"># debug, count inf and 0 tan</span>
        <span class="c1"># numZeros = np.count_nonzero(drewVelocity==0)</span>
        <span class="c1"># logger.info(f&#39;  1) numZeros:{numZeros}&#39;)</span>

        <span class="c1"># remove inf and 0 tan()</span>
        <span class="c1"># np.tan(90 deg) is returning 1e16 rather than inf</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;not removing inf/0 velocity --&gt;&gt; use this to calculate stalls&quot;</span><span class="p">)</span>
        <span class="c1"># tan90or0 = (drewVelocity &gt; 1e6) | (drewVelocity == 0)</span>
        <span class="c1"># drewVelocity[tan90or0] = float(&#39;nan&#39;)</span>

        <span class="c1"># our original in kym_file_v0.py saved these columns:</span>
        <span class="c1"># time,velocity,parentFolder,file,algorithm,delx,delt,numLines,pntsPerLine,cleanVelocity,absVelocity</span>

        <span class="n">cleanVelocity</span> <span class="o">=</span> <span class="n">_removeOutliers</span><span class="p">(</span><span class="n">drewVelocity</span><span class="p">)</span>
        <span class="n">cleanVelocity</span> <span class="o">=</span> <span class="n">_medianFilter</span><span class="p">(</span><span class="n">cleanVelocity</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">drewTime</span><span class="p">,</span>
                <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">drewVelocity</span><span class="p">,</span>
                <span class="s2">&quot;parentFolder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;mpRadon&quot;</span><span class="p">,</span>
                <span class="s2">&quot;delx&quot;</span><span class="p">:</span> <span class="n">umPerPixel</span><span class="p">,</span>
                <span class="s2">&quot;delt&quot;</span><span class="p">:</span> <span class="n">secondsPerLine</span><span class="p">,</span>
                <span class="s2">&quot;numLines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_lines</span><span class="p">,</span>
                <span class="s2">&quot;pntsPerLine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_line</span><span class="p">,</span>
                <span class="s2">&quot;cleanVelocity&quot;</span><span class="p">:</span> <span class="n">cleanVelocity</span><span class="p">,</span>  <span class="c1"># what were these in v0</span>
                <span class="s2">&quot;absVelocity&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cleanVelocity</span><span class="p">),</span>  <span class="c1"># what were these in v0</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Mark as dirty so save_analysis() will save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Auto-save analysis after successful computation</span>
        <span class="c1"># self.save_analysis()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save analysis results to CSV and JSON files.</span>

<span class="sd">        Saves the analysis DataFrame to a CSV file and metadata to a JSON file</span>
<span class="sd">        in the analysis folder (parent folder + &#39;-analysis&#39; suffix). Only saves</span>
<span class="sd">        if the file is marked as dirty (has unsaved changes).</span>

<span class="sd">        CSV contains: time, velocity, parentFolder, file, algorithm, delx, delt,</span>
<span class="sd">        numLines, pntsPerLine, cleanVelocity, absVelocity.</span>

<span class="sd">        JSON contains: OlympusHeader, ExperimentMetadata, AnalysisParameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if analysis was saved successfully, False if no analysis exists</span>
<span class="sd">            or file is not dirty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis does not need to be for  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisExists</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis to save for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">csv_path</span><span class="p">,</span> <span class="n">json_path</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># our original in kym_file_v0.py saved these columns:</span>
        <span class="c1"># time,velocity,parentFolder,file,algorithm,delx,delt,numLines,pntsPerLine,cleanVelocity,absVelocity</span>

        <span class="c1"># Save CSV (no index, no header row)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved analysis CSV to </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Build JSON metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;olympus_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;experiment_metadata&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;analysis_parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="c1"># Save JSON</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved analysis metadata to </span><span class="si">{</span><span class="n">json_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update analysis snapshot with result path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">result_path</span> <span class="o">=</span> <span class="n">csv_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load metadata from saved JSON file.</span>

<span class="sd">        Loads Olympus header, experiment metadata, and analysis parameters</span>
<span class="sd">        from the JSON file in the analysis folder. Overwrites current metadata</span>
<span class="sd">        if the file exists.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if metadata was loaded successfully, False if the JSON file</span>
<span class="sd">            does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">json_path</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">json_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metadata file found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Load JSON metadata</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Restore OlympusHeader if not already loaded</span>
        <span class="k">if</span> <span class="s2">&quot;olympus_header&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">header_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;olympus_header&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="p">(</span>
                <span class="n">um_per_pixel</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;um_per_pixel&quot;</span><span class="p">),</span>
                <span class="n">seconds_per_line</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seconds_per_line&quot;</span><span class="p">),</span>
                <span class="n">duration_seconds</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duration_seconds&quot;</span><span class="p">),</span>
                <span class="n">pixels_per_line</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pixels_per_line&quot;</span><span class="p">),</span>
                <span class="n">num_lines</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_lines&quot;</span><span class="p">),</span>
                <span class="n">bits_per_pixel</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bits_per_pixel&quot;</span><span class="p">),</span>
                <span class="n">date_str</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">),</span>
                <span class="n">time_str</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Restore ExperimentMetadata</span>
        <span class="k">if</span> <span class="s2">&quot;experiment_metadata&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">bio_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;experiment_metadata&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span> <span class="o">=</span> <span class="n">ExperimentMetadata</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">bio_data</span><span class="p">)</span>

        <span class="c1"># Restore AnalysisParameters</span>
        <span class="k">if</span> <span class="s2">&quot;analysis_parameters&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">snap_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;analysis_parameters&quot;</span><span class="p">]</span>
            <span class="n">analyzed_at_str</span> <span class="o">=</span> <span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analyzed_at&quot;</span><span class="p">)</span>
            <span class="n">analyzed_at</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">analyzed_at_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">analyzed_at_str</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">(</span>
                <span class="n">algorithm</span><span class="o">=</span><span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">),</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">),</span>
                <span class="n">analyzed_at</span><span class="o">=</span><span class="n">analyzed_at</span><span class="p">,</span>
                <span class="n">result_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">snap_data</span><span class="p">[</span><span class="s2">&quot;result_path&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result_path&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load analysis results from CSV and JSON files.</span>

<span class="sd">        Loads the analysis DataFrame from CSV and metadata from JSON in the</span>
<span class="sd">        analysis folder. This is called automatically during initialization</span>
<span class="sd">        if analysis files exist.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if analysis was loaded successfully, False if the CSV file</span>
<span class="sd">            does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">csv_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Check if files exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis files found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Load CSV into DataFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata</span><span class="p">()</span>

        <span class="c1"># logger.info(f&quot;Loaded analysis for {self.path.name}&quot;)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysisExists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if analysis has been loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getAnalysisValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a value from the analysis DataFrame.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis loaded for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in analysis DataFrame for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Convenience information</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of lines (time dimension) in the kymograph.&quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">header</span><span class="o">.</span><span class="n">num_lines</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pixels_per_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of pixels per line (spatial dimension) in the kymograph.&quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">header</span><span class="o">.</span><span class="n">pixels_per_line</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">duration_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total recording duration in seconds.&quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">header</span><span class="o">.</span><span class="n">duration_seconds</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h4 id="kymflow_core.kym_file.KymFile-attributes">Attributes<a href="#kymflow_core.kym_file.KymFile-attributes" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-attribute">



<h5 id="kymflow_core.kym_file.KymFile.analysisExists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analysisExists</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#kymflow_core.kym_file.KymFile.analysisExists" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Check if analysis has been loaded.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="kymflow_core.kym_file.KymFile.duration_seconds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">duration_seconds</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#kymflow_core.kym_file.KymFile.duration_seconds" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Total recording duration in seconds.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="kymflow_core.kym_file.KymFile.num_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#kymflow_core.kym_file.KymFile.num_lines" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Number of lines (time dimension) in the kymograph.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="kymflow_core.kym_file.KymFile.pixels_per_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pixels_per_line</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#kymflow_core.kym_file.KymFile.pixels_per_line" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Number of pixels per line (spatial dimension) in the kymograph.</p>

    </div>

</div>


<h4 id="kymflow_core.kym_file.KymFile-functions">Functions<a href="#kymflow_core.kym_file.KymFile-functions" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.KymFile.__init__" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Initialize KymFile instance.</p>
<p>Loads metadata from the TIFF file and accompanying Olympus header file
if available. Optionally loads the image data immediately if requested.
Analysis data is automatically loaded if available.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the kymograph TIFF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_image</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, load the TIFF image data immediately. If False,
image will be loaded lazily when needed. Defaults to False for
efficient metadata-only workflows.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize KymFile instance.</span>

<span class="sd">    Loads metadata from the TIFF file and accompanying Olympus header file</span>
<span class="sd">    if available. Optionally loads the image data immediately if requested.</span>
<span class="sd">    Analysis data is automatically loaded if available.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Path to the kymograph TIFF file.</span>
<span class="sd">        load_image: If True, load the TIFF image data immediately. If False,</span>
<span class="sd">            image will be loaded lazily when needed. Defaults to False for</span>
<span class="sd">            efficient metadata-only workflows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">:</span> <span class="n">ExperimentMetadata</span> <span class="o">=</span> <span class="n">ExperimentMetadata</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">:</span> <span class="n">OlympusHeader</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="p">()</span>  <span class="c1"># header is default values</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="p">:</span> <span class="n">AnalysisParameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># full df loaded from csv file</span>

    <span class="c1"># try and load Olympus header from txt file if it exists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="o">.</span><span class="n">from_tif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">load_analysis</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">load_image</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.analyze_flow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_flow</span><span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">start_pixel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_pixel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_cancelled</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.KymFile.analyze_flow" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Run Radon-based flow analysis on the kymograph.</p>
<p>Performs a sliding window analysis along the time axis using Radon
transforms to detect flow direction and velocity. Results are stored
internally and can be saved using save_analysis(). The image must
be loaded before calling this method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time lines per analysis window. Must be
a multiple of 4.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_pixel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start index in space dimension (inclusive). If None,
uses 0.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_pixel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stop index in space dimension (exclusive). If None,
uses full width.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progress_callback</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="kymflow_core.kym_file.ProgressCallback">ProgressCallback</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional callback function(completed, total)
called periodically to report progress.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_cancelled</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="kymflow_core.kym_file.CancelCallback">CancelCallback</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional callback function() -&gt; bool that returns
True if analysis should be cancelled.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_multiprocessing</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use multiprocessing for parallel
computation. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If window_size is invalid or data dimensions are
incompatible.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FlowCancelled">FlowCancelled</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If analysis is cancelled via is_cancelled callback.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_flow</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>  <span class="c1"># boundary between positional and keyword-only arguments</span>
    <span class="n">start_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stop_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProgressCallback</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_cancelled</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CancelCallback</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_multiprocessing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run Radon-based flow analysis on the kymograph.</span>

<span class="sd">    Performs a sliding window analysis along the time axis using Radon</span>
<span class="sd">    transforms to detect flow direction and velocity. Results are stored</span>
<span class="sd">    internally and can be saved using save_analysis(). The image must</span>
<span class="sd">    be loaded before calling this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        window_size: Number of time lines per analysis window. Must be</span>
<span class="sd">            a multiple of 4.</span>
<span class="sd">        start_pixel: Start index in space dimension (inclusive). If None,</span>
<span class="sd">            uses 0.</span>
<span class="sd">        stop_pixel: Stop index in space dimension (exclusive). If None,</span>
<span class="sd">            uses full width.</span>
<span class="sd">        progress_callback: Optional callback function(completed, total)</span>
<span class="sd">            called periodically to report progress.</span>
<span class="sd">        is_cancelled: Optional callback function() -&gt; bool that returns</span>
<span class="sd">            True if analysis should be cancelled.</span>
<span class="sd">        use_multiprocessing: If True, use multiprocessing for parallel</span>
<span class="sd">            computation. Defaults to True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If window_size is invalid or data dimensions are</span>
<span class="sd">            incompatible.</span>
<span class="sd">        FlowCancelled: If analysis is cancelled via is_cancelled callback.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_image_loaded</span><span class="p">()</span>

    <span class="n">thetas</span><span class="p">,</span> <span class="n">the_t</span><span class="p">,</span> <span class="n">spread</span> <span class="o">=</span> <span class="n">mp_analyze_flow</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">window_size</span><span class="p">,</span>
        <span class="n">start_pixel</span><span class="o">=</span><span class="n">start_pixel</span><span class="p">,</span>
        <span class="n">stop_pixel</span><span class="o">=</span><span class="n">stop_pixel</span><span class="p">,</span>
        <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
        <span class="n">is_cancelled</span><span class="o">=</span><span class="n">is_cancelled</span><span class="p">,</span>
        <span class="n">use_multiprocessing</span><span class="o">=</span><span class="n">use_multiprocessing</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Store lightweight metadata for UI access.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">(</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;mpRadon&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="n">window_size</span><span class="p">,</span>
            <span class="s2">&quot;start_pixel&quot;</span><span class="p">:</span> <span class="n">start_pixel</span><span class="p">,</span>
            <span class="s2">&quot;stop_pixel&quot;</span><span class="p">:</span> <span class="n">stop_pixel</span><span class="p">,</span>
            <span class="s2">&quot;use_multiprocessing&quot;</span><span class="p">:</span> <span class="n">use_multiprocessing</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">analyzed_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">secondsPerLine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span>
    <span class="n">umPerPixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">um_per_pixel</span>

    <span class="c1"># convert to physical units</span>
    <span class="n">drewTime</span> <span class="o">=</span> <span class="n">the_t</span> <span class="o">*</span> <span class="n">secondsPerLine</span>

    <span class="c1"># convert radians to angle</span>
    <span class="n">_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span>
    <span class="n">drewVelocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">umPerPixel</span> <span class="o">/</span> <span class="n">secondsPerLine</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_rad</span><span class="p">)</span>
    <span class="n">drewVelocity</span> <span class="o">=</span> <span class="n">drewVelocity</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># mm/s</span>

    <span class="c1"># debug, count inf and 0 tan</span>
    <span class="c1"># numZeros = np.count_nonzero(drewVelocity==0)</span>
    <span class="c1"># logger.info(f&#39;  1) numZeros:{numZeros}&#39;)</span>

    <span class="c1"># remove inf and 0 tan()</span>
    <span class="c1"># np.tan(90 deg) is returning 1e16 rather than inf</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;not removing inf/0 velocity --&gt;&gt; use this to calculate stalls&quot;</span><span class="p">)</span>
    <span class="c1"># tan90or0 = (drewVelocity &gt; 1e6) | (drewVelocity == 0)</span>
    <span class="c1"># drewVelocity[tan90or0] = float(&#39;nan&#39;)</span>

    <span class="c1"># our original in kym_file_v0.py saved these columns:</span>
    <span class="c1"># time,velocity,parentFolder,file,algorithm,delx,delt,numLines,pntsPerLine,cleanVelocity,absVelocity</span>

    <span class="n">cleanVelocity</span> <span class="o">=</span> <span class="n">_removeOutliers</span><span class="p">(</span><span class="n">drewVelocity</span><span class="p">)</span>
    <span class="n">cleanVelocity</span> <span class="o">=</span> <span class="n">_medianFilter</span><span class="p">(</span><span class="n">cleanVelocity</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">drewTime</span><span class="p">,</span>
            <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">drewVelocity</span><span class="p">,</span>
            <span class="s2">&quot;parentFolder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;mpRadon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delx&quot;</span><span class="p">:</span> <span class="n">umPerPixel</span><span class="p">,</span>
            <span class="s2">&quot;delt&quot;</span><span class="p">:</span> <span class="n">secondsPerLine</span><span class="p">,</span>
            <span class="s2">&quot;numLines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_lines</span><span class="p">,</span>
            <span class="s2">&quot;pntsPerLine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_line</span><span class="p">,</span>
            <span class="s2">&quot;cleanVelocity&quot;</span><span class="p">:</span> <span class="n">cleanVelocity</span><span class="p">,</span>  <span class="c1"># what were these in v0</span>
            <span class="s2">&quot;absVelocity&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cleanVelocity</span><span class="p">),</span>  <span class="c1"># what were these in v0</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Mark as dirty so save_analysis() will save</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.ensure_image_loaded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_image_loaded</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.KymFile.ensure_image_loaded" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Load and return the kymograph image data.</p>
<p>Implements lazy loading - the image is only loaded from disk when
this method is called. Subsequent calls return the cached image.
The image is flipped horizontally to match the expected orientation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D numpy array with shape (time, space) where axis 0 is time</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(line scans) and axis 1 is space (pixels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ensure_image_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load and return the kymograph image data.</span>

<span class="sd">    Implements lazy loading - the image is only loaded from disk when</span>
<span class="sd">    this method is called. Subsequent calls return the cached image.</span>
<span class="sd">    The image is flipped horizontally to match the expected orientation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        2D numpy array with shape (time, space) where axis 0 is time</span>
<span class="sd">        (line scans) and axis 1 is space (pixels).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># abb 20251121</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># logger.info(f&#39;image loaded: {self._image.shape} dtype:{self._image.dtype}&#39;)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.getAnalysisValue" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getAnalysisValue</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.KymFile.getAnalysisValue" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Get a value from the analysis DataFrame.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getAnalysisValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a value from the analysis DataFrame.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis loaded for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in analysis DataFrame for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.load_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_analysis</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.KymFile.load_analysis" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Load analysis results from CSV and JSON files.</p>
<p>Loads the analysis DataFrame from CSV and metadata from JSON in the
analysis folder. This is called automatically during initialization
if analysis files exist.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if analysis was loaded successfully, False if the CSV file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load analysis results from CSV and JSON files.</span>

<span class="sd">    Loads the analysis DataFrame from CSV and metadata from JSON in the</span>
<span class="sd">    analysis folder. This is called automatically during initialization</span>
<span class="sd">    if analysis files exist.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if analysis was loaded successfully, False if the CSV file</span>
<span class="sd">        does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">csv_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Check if files exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis files found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Load CSV into DataFrame</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata</span><span class="p">()</span>

    <span class="c1"># logger.info(f&quot;Loaded analysis for {self.path.name}&quot;)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.load_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_metadata</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.KymFile.load_metadata" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Load metadata from saved JSON file.</p>
<p>Loads Olympus header, experiment metadata, and analysis parameters
from the JSON file in the analysis folder. Overwrites current metadata
if the file exists.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if metadata was loaded successfully, False if the JSON file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load metadata from saved JSON file.</span>

<span class="sd">    Loads Olympus header, experiment metadata, and analysis parameters</span>
<span class="sd">    from the JSON file in the analysis folder. Overwrites current metadata</span>
<span class="sd">    if the file exists.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if metadata was loaded successfully, False if the JSON file</span>
<span class="sd">        does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">json_path</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">json_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metadata file found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Load JSON metadata</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Restore OlympusHeader if not already loaded</span>
    <span class="k">if</span> <span class="s2">&quot;olympus_header&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">header_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;olympus_header&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">OlympusHeader</span><span class="p">(</span>
            <span class="n">um_per_pixel</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;um_per_pixel&quot;</span><span class="p">),</span>
            <span class="n">seconds_per_line</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seconds_per_line&quot;</span><span class="p">),</span>
            <span class="n">duration_seconds</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duration_seconds&quot;</span><span class="p">),</span>
            <span class="n">pixels_per_line</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pixels_per_line&quot;</span><span class="p">),</span>
            <span class="n">num_lines</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_lines&quot;</span><span class="p">),</span>
            <span class="n">bits_per_pixel</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bits_per_pixel&quot;</span><span class="p">),</span>
            <span class="n">date_str</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">),</span>
            <span class="n">time_str</span><span class="o">=</span><span class="n">header_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># Restore ExperimentMetadata</span>
    <span class="k">if</span> <span class="s2">&quot;experiment_metadata&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">bio_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;experiment_metadata&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span> <span class="o">=</span> <span class="n">ExperimentMetadata</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">bio_data</span><span class="p">)</span>

    <span class="c1"># Restore AnalysisParameters</span>
    <span class="k">if</span> <span class="s2">&quot;analysis_parameters&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">snap_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;analysis_parameters&quot;</span><span class="p">]</span>
        <span class="n">analyzed_at_str</span> <span class="o">=</span> <span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analyzed_at&quot;</span><span class="p">)</span>
        <span class="n">analyzed_at</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">analyzed_at_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">analyzed_at_str</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span> <span class="o">=</span> <span class="n">AnalysisParameters</span><span class="p">(</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">),</span>
            <span class="n">analyzed_at</span><span class="o">=</span><span class="n">analyzed_at</span><span class="p">,</span>
            <span class="n">result_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">snap_data</span><span class="p">[</span><span class="s2">&quot;result_path&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">snap_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result_path&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.save_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_analysis</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.KymFile.save_analysis" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Save analysis results to CSV and JSON files.</p>
<p>Saves the analysis DataFrame to a CSV file and metadata to a JSON file
in the analysis folder (parent folder + '-analysis' suffix). Only saves
if the file is marked as dirty (has unsaved changes).</p>
<p>CSV contains: time, velocity, parentFolder, file, algorithm, delx, delt,
numLines, pntsPerLine, cleanVelocity, absVelocity.</p>
<p>JSON contains: OlympusHeader, ExperimentMetadata, AnalysisParameters.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if analysis was saved successfully, False if no analysis exists</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>or file is not dirty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save analysis results to CSV and JSON files.</span>

<span class="sd">    Saves the analysis DataFrame to a CSV file and metadata to a JSON file</span>
<span class="sd">    in the analysis folder (parent folder + &#39;-analysis&#39; suffix). Only saves</span>
<span class="sd">    if the file is marked as dirty (has unsaved changes).</span>

<span class="sd">    CSV contains: time, velocity, parentFolder, file, algorithm, delx, delt,</span>
<span class="sd">    numLines, pntsPerLine, cleanVelocity, absVelocity.</span>

<span class="sd">    JSON contains: OlympusHeader, ExperimentMetadata, AnalysisParameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if analysis was saved successfully, False if no analysis exists</span>
<span class="sd">        or file is not dirty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis does not need to be for  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisExists</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis to save for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">csv_path</span><span class="p">,</span> <span class="n">json_path</span> <span class="o">=</span> <span class="n">_getSavePaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># our original in kym_file_v0.py saved these columns:</span>
    <span class="c1"># time,velocity,parentFolder,file,algorithm,delx,delt,numLines,pntsPerLine,cleanVelocity,absVelocity</span>

    <span class="c1"># Save CSV (no index, no header row)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dfAnalysis</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved analysis CSV to </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Build JSON metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;olympus_header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="s2">&quot;experiment_metadata&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="s2">&quot;analysis_parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="c1"># Save JSON</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved analysis metadata to </span><span class="si">{</span><span class="n">json_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Update analysis snapshot with result path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">result_path</span> <span class="o">=</span> <span class="n">csv_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.summary_row" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary_row</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.KymFile.summary_row" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Generate tabular summary for file list views.</p>
<p>Returns a dictionary with key metadata fields formatted for display
in table views. Includes file name, folder hierarchy, analysis status,
and key acquisition parameters.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with keys suitable for table display, including file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name, folder names, analysis status, and metadata values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">summary_row</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate tabular summary for file list views.</span>

<span class="sd">    Returns a dictionary with key metadata fields formatted for display</span>
<span class="sd">    in table views. Includes file name, folder hierarchy, analysis status,</span>
<span class="sd">    and key acquisition parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with keys suitable for table display, including file</span>
<span class="sd">        name, folder names, analysis status, and metadata values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;File Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;Parent Folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;Grandparent Folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;Analyzed&quot;</span><span class="p">:</span> <span class="s2">&quot;✓&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisExists</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Saved&quot;</span><span class="p">:</span> <span class="s2">&quot;✓&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Window Points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;window_size&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span>
        <span class="p">),</span>
        <span class="s2">&quot;pixels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_line</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_lines</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;duration (s)&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ms/line&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">seconds_per_line</span>
        <span class="k">else</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;um/pixel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">um_per_pixel</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bits/pixel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">bits_per_pixel</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_metadata</span><span class="o">.</span><span class="n">note</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>  <span class="c1"># special case, not in any shema</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.table_column_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">table_column_schema</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.KymFile.table_column_schema" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Return column visibility schema for table display.</p>
<p>Generates a dictionary mapping column names from summary_row() to
visibility flags. Reuses existing form schemas where possible to
avoid duplication of visibility rules.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping column names to boolean visibility flags.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Columns not in the mapping default to visible=True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">table_column_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return column visibility schema for table display.</span>

<span class="sd">    Generates a dictionary mapping column names from summary_row() to</span>
<span class="sd">    visibility flags. Reuses existing form schemas where possible to</span>
<span class="sd">    avoid duplication of visibility rules.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping column names to boolean visibility flags.</span>
<span class="sd">        Columns not in the mapping default to visible=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Mapping from summary_row keys to (dataclass_class, field_name) for schema lookup</span>
    <span class="c1"># Keys not in this mapping are derived/computed fields</span>
    <span class="n">schema_field_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ExperimentMetadata</span><span class="p">,</span> <span class="s2">&quot;note&quot;</span><span class="p">),</span>
        <span class="s2">&quot;um/pixel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">OlympusHeader</span><span class="p">,</span> <span class="s2">&quot;um_per_pixel&quot;</span><span class="p">),</span>
        <span class="c1"># &quot;pixels&quot;, &quot;lines&quot;, &quot;duration (s)&quot;, &quot;ms/line&quot; are derived from OlympusHeader</span>
        <span class="c1"># but with different names, so we&#39;d need property mappings - keeping simple for now</span>
    <span class="p">}</span>

    <span class="c1"># Override dict for columns not in any schema (derived/computed fields)</span>
    <span class="c1"># Defaults to True if not specified</span>
    <span class="n">visibility_overrides</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Always hide - used as row_key only</span>
        <span class="c1"># All other columns default to visible=True (don&#39;t need to list them)</span>
    <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Look up visibility from existing form schemas</span>
    <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="p">(</span><span class="n">dataclass_cls</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">schema_field_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">form_schema</span> <span class="o">=</span> <span class="n">dataclass_cls</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">form_schema</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">field_name</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="c1"># Apply overrides (takes precedence)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">visibility_overrides</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.to_metadata_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_metadata_dict</span><span class="p">(</span><span class="n">include_analysis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.KymFile.to_metadata_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Merge all metadata into a single dictionary.</p>
<p>Combines Olympus header data, experimental metadata, and optionally
analysis parameters into a unified dictionary structure. This is the
primary format consumed by GUI tables and CLI scripts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>include_analysis</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, include analysis parameters in the
output. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing path, filename, and all metadata fields</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>from header, experiment metadata, and optionally analysis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_metadata_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_analysis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge all metadata into a single dictionary.</span>

<span class="sd">    Combines Olympus header data, experimental metadata, and optionally</span>
<span class="sd">    analysis parameters into a unified dictionary structure. This is the</span>
<span class="sd">    primary format consumed by GUI tables and CLI scripts.</span>

<span class="sd">    Args:</span>
<span class="sd">        include_analysis: If True, include analysis parameters in the</span>
<span class="sd">            output. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing path, filename, and all metadata fields</span>
<span class="sd">        from header, experiment metadata, and optionally analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_header_loaded</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># header is always loaded in __init__ (can be default)</span>
    <span class="n">merged</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="c1"># &quot;filesize_bytes&quot;: self.path.stat().st_size if self.path.exists() else None,</span>
    <span class="p">}</span>
    <span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
    <span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">include_analysis</span><span class="p">:</span>
        <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.KymFile.update_experiment_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_experiment_metadata</span><span class="p">(</span><span class="o">**</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.KymFile.update_experiment_metadata" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Update stored experimental metadata fields.</p>
<p>Updates one or more fields in the experiment metadata. Unknown fields
are silently ignored. Marks the file as dirty (needs saving).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**fields</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments mapping field names to new values.
Only fields that exist in ExperimentMetadata are updated.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_experiment_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update stored experimental metadata fields.</span>

<span class="sd">    Updates one or more fields in the experiment metadata. Unknown fields</span>
<span class="sd">    are silently ignored. Marks the file as dirty (needs saving).</span>

<span class="sd">    Args:</span>
<span class="sd">        **fields: Keyword arguments mapping field names to new values.</span>
<span class="sd">            Only fields that exist in ExperimentMetadata are updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fields:</span><span class="si">{</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_metadata</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c1"># Unknown keys are silently ignored (strict schema-only strategy)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dirty</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="kymflow_core.kym_file.OlympusHeader" class="doc doc-heading">
            <code>OlympusHeader</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#kymflow_core.kym_file.OlympusHeader" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">



        <p>Structured representation of Olympus microscope header metadata.</p>
<p>Contains acquisition parameters extracted from the Olympus .txt header file
that accompanies kymograph TIFF files. All fields have default values to
handle cases where the header file is missing.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.um_per_pixel">um_per_pixel</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spatial resolution in micrometers per pixel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.seconds_per_line">seconds_per_line</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal resolution in seconds per line scan.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.duration_seconds">duration_seconds</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total recording duration in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.pixels_per_line">pixels_per_line</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels in the spatial dimension.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.num_lines">num_lines</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of line scans in the temporal dimension.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.bits_per_pixel">bits_per_pixel</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bit depth of the image data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.date_str">date_str</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Acquisition date string from header.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.time_str">time_str</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Acquisition time string from header.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="kymflow_core.kym_file.OlympusHeader.raw">raw</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw dictionary of all parsed header values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OlympusHeader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured representation of Olympus microscope header metadata.</span>

<span class="sd">    Contains acquisition parameters extracted from the Olympus .txt header file</span>
<span class="sd">    that accompanies kymograph TIFF files. All fields have default values to</span>
<span class="sd">    handle cases where the header file is missing.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        um_per_pixel: Spatial resolution in micrometers per pixel.</span>
<span class="sd">        seconds_per_line: Temporal resolution in seconds per line scan.</span>
<span class="sd">        duration_seconds: Total recording duration in seconds.</span>
<span class="sd">        pixels_per_line: Number of pixels in the spatial dimension.</span>
<span class="sd">        num_lines: Number of line scans in the temporal dimension.</span>
<span class="sd">        bits_per_pixel: Bit depth of the image data.</span>
<span class="sd">        date_str: Acquisition date string from header.</span>
<span class="sd">        time_str: Acquisition time string from header.</span>
<span class="sd">        raw: Raw dictionary of all parsed header values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># OlympusHeader needs defaults in case corresponding Olympus txt file is not found</span>
    <span class="n">um_per_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;um/pixel&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">seconds_per_line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>  <span class="c1"># 1 ms</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;seconds/line&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">duration_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Duration (s)&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">pixels_per_line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pixels/Line&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">num_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lines&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">bits_per_pixel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Bits/Pixel&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">date_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">time_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">raw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">field_metadata</span><span class="p">(</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw&quot;</span><span class="p">,</span>
            <span class="n">widget_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">grid_span</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Full width for raw dict</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Hide raw dict from form display</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_tif</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tif_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;OlympusHeader&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load Olympus header from accompanying .txt file.</span>

<span class="sd">        Attempts to parse the Olympus header file that should be in the same</span>
<span class="sd">        directory as the TIFF file with the same base name. Returns a header</span>
<span class="sd">        with default values if the file is not found or cannot be parsed.</span>

<span class="sd">        Args:</span>
<span class="sd">            tif_path: Path to the TIFF file. The corresponding .txt file will</span>
<span class="sd">                be looked up in the same directory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            OlympusHeader instance with parsed values, or default values if</span>
<span class="sd">            the header file is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">_readOlympusHeader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tif_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">um_per_pixel</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;umPerPixel&quot;</span><span class="p">),</span>
            <span class="n">seconds_per_line</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secondsPerLine&quot;</span><span class="p">),</span>
            <span class="n">duration_seconds</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durImage_sec&quot;</span><span class="p">),</span>
            <span class="n">pixels_per_line</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pixelsPerLine&quot;</span><span class="p">),</span>
            <span class="n">num_lines</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;numLines&quot;</span><span class="p">),</span>
            <span class="n">bits_per_pixel</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bitsPerPixel&quot;</span><span class="p">),</span>
            <span class="n">date_str</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dateStr&quot;</span><span class="p">),</span>
            <span class="n">time_str</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeStr&quot;</span><span class="p">),</span>
            <span class="n">raw</span><span class="o">=</span><span class="n">parsed</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary with renamed keys.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary representation with date_str and time_str renamed to</span>
<span class="sd">            date and time for compatibility with external APIs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Rename keys</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;date_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;time_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">        Generates a list of field definitions with metadata extracted from</span>
<span class="sd">        the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">        generate forms without hardcoding field information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">            widget type, grid span, visibility, and field type information.</span>
<span class="sd">            Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                    <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># Order is determined by the order of the fields in the dataclass</span>
        <span class="k">return</span> <span class="n">schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_editable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current values for editable fields only.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping field names to string representations of their</span>
<span class="sd">            current values. Only includes fields marked as editable in the</span>
<span class="sd">            form schema. None values are converted to empty strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;editable&quot;</span><span class="p">]:</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="c1"># Convert to string, handling None and dict types</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="kymflow_core.kym_file.OlympusHeader-functions">Functions<a href="#kymflow_core.kym_file.OlympusHeader-functions" class="headerlink" title="Permanent link">¤</a></h4>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.OlympusHeader.form_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_schema</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.OlympusHeader.form_schema" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Return field schema for form generation.</p>
<p>Generates a list of field definitions with metadata extracted from
the dataclass field definitions. Used by GUI frameworks to dynamically
generate forms without hardcoding field information.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries, each containing field name, label, editability,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>widget type, grid span, visibility, and field type information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fields are ordered by their declaration order in the dataclass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">form_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return field schema for form generation.</span>

<span class="sd">    Generates a list of field definitions with metadata extracted from</span>
<span class="sd">    the dataclass field definitions. Used by GUI frameworks to dynamically</span>
<span class="sd">    generate forms without hardcoding field information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of dictionaries, each containing field name, label, editability,</span>
<span class="sd">        widget type, grid span, visibility, and field type information.</span>
<span class="sd">        Fields are ordered by their declaration order in the dataclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field_obj</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">field_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;widget_type&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">),</span>
                <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">),</span>
                <span class="s2">&quot;grid_span&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grid_span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># Order is determined by the order of the fields in the dataclass</span>
    <span class="k">return</span> <span class="n">schema</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.OlympusHeader.from_tif" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_tif</span><span class="p">(</span><span class="n">tif_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#kymflow_core.kym_file.OlympusHeader.from_tif" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Load Olympus header from accompanying .txt file.</p>
<p>Attempts to parse the Olympus header file that should be in the same
directory as the TIFF file with the same base name. Returns a header
with default values if the file is not found or cannot be parsed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tif_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the TIFF file. The corresponding .txt file will
be looked up in the same directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;OlympusHeader&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OlympusHeader instance with parsed values, or default values if</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;OlympusHeader&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the header file is missing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_tif</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tif_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;OlympusHeader&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load Olympus header from accompanying .txt file.</span>

<span class="sd">    Attempts to parse the Olympus header file that should be in the same</span>
<span class="sd">    directory as the TIFF file with the same base name. Returns a header</span>
<span class="sd">    with default values if the file is not found or cannot be parsed.</span>

<span class="sd">    Args:</span>
<span class="sd">        tif_path: Path to the TIFF file. The corresponding .txt file will</span>
<span class="sd">            be looked up in the same directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        OlympusHeader instance with parsed values, or default values if</span>
<span class="sd">        the header file is missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">_readOlympusHeader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tif_path</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">um_per_pixel</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;umPerPixel&quot;</span><span class="p">),</span>
        <span class="n">seconds_per_line</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secondsPerLine&quot;</span><span class="p">),</span>
        <span class="n">duration_seconds</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durImage_sec&quot;</span><span class="p">),</span>
        <span class="n">pixels_per_line</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pixelsPerLine&quot;</span><span class="p">),</span>
        <span class="n">num_lines</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;numLines&quot;</span><span class="p">),</span>
        <span class="n">bits_per_pixel</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bitsPerPixel&quot;</span><span class="p">),</span>
        <span class="n">date_str</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dateStr&quot;</span><span class="p">),</span>
        <span class="n">time_str</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeStr&quot;</span><span class="p">),</span>
        <span class="n">raw</span><span class="o">=</span><span class="n">parsed</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.OlympusHeader.get_editable_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_editable_values</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.OlympusHeader.get_editable_values" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Get current values for editable fields only.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping field names to string representations of their</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current values. Only includes fields marked as editable in the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>form schema. None values are converted to empty strings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_editable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current values for editable fields only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping field names to string representations of their</span>
<span class="sd">        current values. Only includes fields marked as editable in the</span>
<span class="sd">        form schema. None values are converted to empty strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_schema</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;editable&quot;</span><span class="p">]:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="c1"># Convert to string, handling None and dict types</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="kymflow_core.kym_file.OlympusHeader.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

<a href="#kymflow_core.kym_file.OlympusHeader.to_dict" class="headerlink" title="Permanent link">¤</a></h5>


    <div class="doc doc-contents ">

        <p>Convert to dictionary with renamed keys.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary representation with date_str and time_str renamed to</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>date and time for compatibility with external APIs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dictionary with renamed keys.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary representation with date_str and time_str renamed to</span>
<span class="sd">        date and time for compatibility with external APIs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># Rename keys</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;date_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;time_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h2 id="kymflow_core.kym_file-functions">Functions<a href="#kymflow_core.kym_file-functions" class="headerlink" title="Permanent link">¤</a></h2>

<div class="doc doc-object doc-function">


<h3 id="kymflow_core.kym_file.collect_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_metadata</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.collect_metadata" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">

        <p>Collect metadata for all TIFF files under a root directory.</p>
<p>Convenience wrapper around iter_metadata() that collects all results
into a list. Useful for GUI applications that need all metadata at once.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root directory to search, or a single file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments passed to iter_metadata() (glob,
follow_symlinks, etc.).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of metadata dictionaries, one per TIFF file found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collect_metadata</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect metadata for all TIFF files under a root directory.</span>

<span class="sd">    Convenience wrapper around iter_metadata() that collects all results</span>
<span class="sd">    into a list. Useful for GUI applications that need all metadata at once.</span>

<span class="sd">    Args:</span>
<span class="sd">        root: Root directory to search, or a single file path.</span>
<span class="sd">        **kwargs: Additional arguments passed to iter_metadata() (glob,</span>
<span class="sd">            follow_symlinks, etc.).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of metadata dictionaries, one per TIFF file found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">iter_metadata</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kymflow_core.kym_file.field_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">field_metadata</span><span class="p">(</span><span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">widget_type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">grid_span</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.field_metadata" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">

        <p>Create field metadata dictionary.</p>
<p>Convenience function that creates a FieldMetadata instance and converts
it to a dictionary suitable for use in dataclass field metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>editable</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the field can be edited by the user.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display label for the field.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>widget_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of widget to use (e.g., "text", "number").</p>
              </div>
            </td>
            <td>
                  <code>&#39;text&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_span</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of grid columns this field spans.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional ordering value for field display.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>visible</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the field should be visible in forms.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing field metadata attributes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">field_metadata</span><span class="p">(</span>
    <span class="n">editable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">widget_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
    <span class="n">grid_span</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create field metadata dictionary.</span>

<span class="sd">    Convenience function that creates a FieldMetadata instance and converts</span>
<span class="sd">    it to a dictionary suitable for use in dataclass field metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        editable: Whether the field can be edited by the user.</span>
<span class="sd">        label: Display label for the field.</span>
<span class="sd">        widget_type: Type of widget to use (e.g., &quot;text&quot;, &quot;number&quot;).</span>
<span class="sd">        grid_span: Number of grid columns this field spans.</span>
<span class="sd">        order: Optional ordering value for field display.</span>
<span class="sd">        visible: Whether the field should be visible in forms.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing field metadata attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FieldMetadata</span><span class="p">(</span>
        <span class="n">editable</span><span class="o">=</span><span class="n">editable</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">widget_type</span><span class="o">=</span><span class="n">widget_type</span><span class="p">,</span>
        <span class="n">grid_span</span><span class="o">=</span><span class="n">grid_span</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="kymflow_core.kym_file.iter_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iter_metadata</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="s1">&#39;*.tif&#39;</span><span class="p">,</span> <span class="n">follow_symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#kymflow_core.kym_file.iter_metadata" class="headerlink" title="Permanent link">¤</a></h3>


    <div class="doc doc-contents ">

        <p>Iterate over metadata for all TIFF files under a root directory.</p>
<p>Efficiently scans a directory tree for TIFF files and yields metadata
dictionaries for each file. Only metadata is loaded - image pixels are
not read, making this suitable for browsing large collections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root directory to search, or a single file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glob</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Glob pattern for matching files. Defaults to "*.tif".</p>
              </div>
            </td>
            <td>
                  <code>&#39;*.tif&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>follow_symlinks</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, follow symbolic links when searching.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing metadata for each TIFF file found, including</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path, filename, Olympus header data, and experiment metadata.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Files that cannot be loaded are silently skipped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/kymflow_core/kym_file.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter_metadata</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">glob</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">,</span>
    <span class="n">follow_symlinks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over metadata for all TIFF files under a root directory.</span>

<span class="sd">    Efficiently scans a directory tree for TIFF files and yields metadata</span>
<span class="sd">    dictionaries for each file. Only metadata is loaded - image pixels are</span>
<span class="sd">    not read, making this suitable for browsing large collections.</span>

<span class="sd">    Args:</span>
<span class="sd">        root: Root directory to search, or a single file path.</span>
<span class="sd">        glob: Glob pattern for matching files. Defaults to &quot;*.tif&quot;.</span>
<span class="sd">        follow_symlinks: If True, follow symbolic links when searching.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Dictionary containing metadata for each TIFF file found, including</span>
<span class="sd">        path, filename, Olympus header data, and experiment metadata.</span>
<span class="sd">        Files that cannot be loaded are silently skipped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">paths</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">glob</span><span class="p">)</span> <span class="k">if</span> <span class="n">follow_symlinks</span> <span class="k">else</span> <span class="n">base</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**/</span><span class="si">{</span><span class="n">glob</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tif_path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tif_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kym</span> <span class="o">=</span> <span class="n">KymFile</span><span class="p">(</span><span class="n">tif_path</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">kym</span><span class="o">.</span><span class="n">to_metadata_dict</span><span class="p">(</span><span class="n">include_analysis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Metadata collection should be resilient; callers can log errors.</span>
            <span class="k">continue</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        All material is Copyright 2011-2023 Robert H. Cudmore
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.instant"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>