{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"KymFlow","text":"<p>Welcome to KymFlow, a tool for analyzing kymograph blood flow data.</p> <p>KymFlow provides both a desktop GUI application and a Python API for working with kymograph TIFF files, editing metadata, and performing Radon-based flow analysis.</p>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li>Installation Guide - Get started with KymFlow</li> <li>User Guide - Learn how to use the GUI</li> <li>API Reference - Programmatic access to kymograph data</li> <li>Examples - Jupyter notebook tutorials</li> </ul>"},{"location":"#features","title":"Features","text":"<ul> <li>GUI Application: Browse, analyze, and manage kymograph files with an intuitive interface</li> <li>Batch Processing: Analyze multiple files sequentially with progress tracking</li> <li>Metadata Management: Edit experimental metadata and save with analysis results</li> <li>Python API: Use the backend programmatically in scripts and notebooks</li> <li>Radon Flow Analysis: Detect flow direction and velocity using Radon transforms</li> </ul>"},{"location":"DEPLOYMENT/","title":"Deploying KymFlow Documentation to GitHub Pages","text":"<p>This guide explains how to deploy the MkDocs documentation site to GitHub Pages.</p>"},{"location":"DEPLOYMENT/#prerequisites","title":"Prerequisites","text":"<ul> <li>MkDocs and dependencies installed: <code>pip install -e \".[docs]\"</code></li> <li>Git repository with write access</li> <li>GitHub repository configured</li> </ul>"},{"location":"DEPLOYMENT/#manual-deployment","title":"Manual Deployment","text":""},{"location":"DEPLOYMENT/#first-time-setup","title":"First-Time Setup","text":"<ol> <li> <p>Build the documentation site: <pre><code>mkdocs build\n</code></pre>    This creates a <code>site/</code> directory with the static HTML files.</p> </li> <li> <p>Deploy to gh-pages branch: <pre><code>mkdocs gh-deploy\n</code></pre>    This command:</p> </li> <li>Builds the site</li> <li>Creates/updates the <code>gh-pages</code> branch</li> <li>Pushes to <code>origin/gh-pages</code></li> <li> <p>GitHub Pages will automatically serve from this branch</p> </li> <li> <p>Configure GitHub Pages (if not already done):</p> </li> <li>Go to repository Settings \u2192 Pages</li> <li>Source: Deploy from a branch</li> <li>Branch: <code>gh-pages</code> / <code>/ (root)</code></li> <li>Save</li> </ol>"},{"location":"DEPLOYMENT/#updating-documentation","title":"Updating Documentation","text":"<p>After making changes to documentation:</p> <pre><code>mkdocs gh-deploy\n</code></pre> <p>This will rebuild and redeploy the site.</p>"},{"location":"DEPLOYMENT/#automated-deployment","title":"Automated Deployment","text":"<p>See <code>.github/workflows/docs.yml</code> for the GitHub Actions workflow that automatically builds and deploys documentation when tags are pushed.</p>"},{"location":"DEPLOYMENT/#verification","title":"Verification","text":"<p>After deployment, the documentation will be available at: - <code>https://mapmanager.github.io/kymflow/</code></p> <p>(Replace <code>mapmanager</code> with your GitHub username/organization if different)</p>"},{"location":"DEPLOYMENT/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>404 errors: Ensure GitHub Pages is enabled and pointing to the <code>gh-pages</code> branch</li> <li>Build errors: Run <code>mkdocs build</code> locally first to catch errors</li> <li>Missing updates: Clear browser cache or wait a few minutes for GitHub to update</li> </ul>"},{"location":"about/","title":"About KymFlow","text":"<p>KymFlow is a tool for analyzing kymograph blood flow data from laser scanning microscopy experiments.</p>"},{"location":"about/#overview","title":"Overview","text":"<p>KymFlow provides both a desktop GUI application and a Python API for working with kymograph TIFF files. The tool enables researchers to:</p> <ul> <li>Load and visualize kymograph images</li> <li>Edit experimental metadata</li> <li>Perform Radon-based flow analysis to detect flow direction and velocity</li> <li>Process multiple files in batch mode</li> <li>Export analysis results for further processing</li> </ul>"},{"location":"about/#features","title":"Features","text":"<ul> <li>Intuitive GUI: Browse, analyze, and manage kymograph files with an easy-to-use interface</li> <li>Batch Processing: Analyze multiple files sequentially with progress tracking</li> <li>Metadata Management: Edit and save experimental metadata alongside analysis results</li> <li>Python API: Use the backend programmatically in scripts and Jupyter notebooks</li> <li>Radon Flow Analysis: Detect flow direction and velocity using Radon transforms</li> </ul>"},{"location":"about/#author","title":"Author","text":"<p>Robert H. Cudmore</p> <ul> <li>Email: robert.cudmore@gmail.com</li> <li>GitHub: mapmanager/kymflow</li> </ul>"},{"location":"about/#license","title":"License","text":"<p>This project is licensed under the GNU General Public License v3 or later (GPLv3+).</p> <p>See the LICENSE file for details.</p>"},{"location":"about/#citation","title":"Citation","text":"<p>If you use KymFlow in your research, please cite:</p> <pre><code>KymFlow: Kymograph Blood Flow Analysis Tool\nRobert H. Cudmore\nhttps://github.com/mapmanager/kymflow\n</code></pre>"},{"location":"about/#contributing","title":"Contributing","text":"<p>Contributions are welcome! Please see the Contributing Guide for details on how to get started.</p>"},{"location":"about/#support","title":"Support","text":"<ul> <li>Issues: Report bugs or request features on GitHub Issues</li> <li>Documentation: Full documentation is available at https://mapmanager.github.io/kymflow/</li> </ul>"},{"location":"about/#acknowledgments","title":"Acknowledgments","text":"<p>KymFlow is designed for analyzing kymograph data from in vivo blood flow imaging experiments, particularly those using laser scanning microscopy techniques.</p>"},{"location":"algorithms/","title":"Algorithms","text":"<p>KymFlow uses a Radon transform-based algorithm to detect flow direction and velocity in kymograph images. This page provides an overview of the algorithm and its implementation.</p>"},{"location":"algorithms/#overview","title":"Overview","text":"<p>The Radon transform algorithm analyzes kymograph images to detect the direction and speed of blood flow. A kymograph is a 2D image where one axis represents time (line scans) and the other represents space (pixels along a line). Flow appears as diagonal streaks in the image, and the angle of these streaks indicates the flow direction and velocity.</p> <p>The algorithm uses a sliding window approach along the time axis, applying Radon transforms to detect the optimal flow angle for each window. This allows tracking flow changes over time.</p>"},{"location":"algorithms/#technical-details","title":"Technical Details","text":""},{"location":"algorithms/#sliding-window-approach","title":"Sliding Window Approach","text":"<p>The algorithm processes the kymograph using overlapping sliding windows:</p> <ul> <li>Window Size: The number of time lines (rows) per analysis window. Must be a multiple of 4.</li> <li>Step Size: Windows are advanced by 25% of the window size (e.g., for window_size=16, step_size=4), creating 75% overlap between consecutive windows.</li> <li>Spatial Range: Optionally, analysis can be limited to a specific range of pixels using <code>start_pixel</code> and <code>stop_pixel</code> parameters.</li> </ul>"},{"location":"algorithms/#two-stage-radon-transform","title":"Two-Stage Radon Transform","text":"<p>For each window, the algorithm performs a two-stage angle search:</p> <ol> <li>Coarse Search: </li> <li>Performs Radon transforms over angles from 0 to 179 degrees (1 degree steps).</li> <li>Finds the angle that maximizes the variance in Radon space.</li> <li> <p>This variance peak indicates the dominant flow direction.</p> </li> <li> <p>Fine Search:</p> </li> <li>Refines the search around the best coarse angle.</li> <li>Searches \u00b12 degrees from the coarse angle in 0.25 degree steps.</li> <li>Returns the angle with maximum variance in this fine grid.</li> </ol>"},{"location":"algorithms/#angle-detection-and-velocity-calculation","title":"Angle Detection and Velocity Calculation","text":"<p>The Radon transform projects the image along lines at different angles. When a line aligns with the flow direction (diagonal streaks), the projection has high variance. The algorithm finds the angle that maximizes this variance.</p> <p>The detected angle (\u03b8) is converted to velocity using:</p> <pre><code>velocity = (um_per_pixel / seconds_per_line) * tan(\u03b8) / 1000\n</code></pre> <p>This converts from radians to mm/s, using the spatial and temporal resolution from the Olympus header metadata.</p>"},{"location":"algorithms/#data-preprocessing","title":"Data Preprocessing","text":"<p>Before analysis, each window is preprocessed:</p> <ul> <li>The mean value is subtracted from the window to remove DC offset.</li> <li>This improves the sensitivity of the Radon transform to flow patterns.</li> </ul>"},{"location":"algorithms/#post-processing","title":"Post-Processing","text":"<p>After angle detection, the velocity values undergo post-processing:</p> <ul> <li>Outlier Removal: Values beyond \u00b12 standard deviations are set to NaN.</li> <li>Median Filtering: A 5-point median filter smooths the velocity time series.</li> </ul>"},{"location":"algorithms/#parameters","title":"Parameters","text":"<p>Key parameters for the analysis:</p> <ul> <li>window_size: Number of time lines per analysis window. Must be a multiple of 4. Larger windows provide better signal-to-noise ratio but reduce temporal resolution.</li> <li>start_pixel: Optional start index in the spatial dimension (inclusive). If None, uses 0.</li> <li>stop_pixel: Optional stop index in the spatial dimension (exclusive). If None, uses full width.</li> <li>use_multiprocessing: If True, uses parallel processing to speed up computation. Defaults to True.</li> </ul>"},{"location":"algorithms/#output","title":"Output","text":"<p>The algorithm produces:</p> <ul> <li>time: Array of center time points for each analysis window (in seconds).</li> <li>velocity: Array of flow velocities (in mm/s) for each window. Positive values indicate flow in one direction, negative values indicate reverse flow.</li> <li>cleanVelocity: Outlier-removed and median-filtered velocity values.</li> <li>absVelocity: Absolute value of cleanVelocity.</li> </ul> <p>Additional metadata is saved including: - parentFolder: Name of the parent folder containing the original TIFF file. - file: Name of the original TIFF file. - algorithm: Algorithm identifier (\"mpRadon\"). - delx: Spatial resolution (um_per_pixel). - delt: Temporal resolution (seconds_per_line). - numLines: Total number of time lines in the kymograph. - pntsPerLine: Number of pixels per line (spatial dimension).</p>"},{"location":"algorithms/#implementation","title":"Implementation","text":"<p>The algorithm is implemented in <code>core.analysis.kym_flow_radon</code> using:</p> <ul> <li>scikit-image: For Radon transform computation (<code>skimage.transform.radon</code>).</li> <li>multiprocessing: For parallel processing of multiple windows.</li> <li>numpy: For array operations and numerical computations.</li> </ul> <p>The main entry point is the <code>mp_analyze_flow()</code> function, which can be called directly or through the <code>KymFile.analyze_flow()</code> method.</p>"},{"location":"algorithms/#references","title":"References","text":"<ul> <li>Radon Transform: Wikipedia</li> <li>scikit-image Radon Transform: Documentation</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to KymFlow!</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<ol> <li> <p>Clone the repository:    <pre><code>git clone https://github.com/mapmanager/kymflow.git\ncd kymflow\n</code></pre></p> </li> <li> <p>Install in editable mode with development dependencies:    <pre><code>pip install -e \".[gui,test,notebook]\"\n</code></pre></p> </li> <li> <p>Run tests:    <pre><code>pytest\n</code></pre></p> </li> </ol>"},{"location":"contributing/#code-style","title":"Code Style","text":"<ul> <li>Follow PEP 8 style guidelines</li> <li>Use type hints for function parameters and return values</li> <li>Add docstrings in Google style format</li> <li>Run linters before submitting PRs</li> </ul>"},{"location":"contributing/#testing","title":"Testing","text":"<ul> <li>Write tests for new features</li> <li>Ensure all tests pass: <code>pytest</code></li> <li>Aim for good test coverage of new code</li> <li>Tests should work without proprietary data when possible</li> </ul>"},{"location":"contributing/#documentation","title":"Documentation","text":"<ul> <li>Update docstrings when adding/changing functions</li> <li>Update user guide for GUI changes</li> <li>Update API docs for backend changes</li> <li>Keep examples in notebooks up to date</li> </ul>"},{"location":"contributing/#submitting-changes","title":"Submitting Changes","text":"<ol> <li>Create a feature branch</li> <li>Make your changes</li> <li>Add/update tests</li> <li>Run tests and ensure they pass</li> <li>Submit a pull request with a clear description</li> </ol>"},{"location":"declan-getting-started/","title":"Declan Getting Started","text":""},{"location":"declan-getting-started/#initial-install","title":"Initial install","text":"<ol> <li>grab the kymflow.app.zip off box</li> <li>grab the declan-stall-v1.zip off box</li> <li>uncompress both files</li> </ol> <p>Always work locally, DO NOT work on files that are on box.</p> <p>We will be working in the raw data folder you just unzipped, <code>declan-stall-v1/</code>.</p> <p>All your work will be saved into <code>declan-stall-v1/</code>. You can then zip the entire folder and put it back on box for me to analyze the results. Important when putting the new declan-stall-v1.zip on box, be sure to put it into a new folder, do not replace the original declan-stall-v1.zip on box.</p> <p>Now that you have a local copy of <code>declan-stall-v1/</code>. Run the KymFlow app ...</p>"},{"location":"declan-getting-started/#first-time-run-of-kymflow-app","title":"First time run of KymFlow app","text":"<p>The first time you run the kymflow app you need to do this.</p> <ul> <li>[[[THIS NO LONGER WORKS]]] Option + Right-click (or Control + Click) on KymFlow.app and select 'Open' from the context menu</li> </ul> <p>This gets you around the initial warning of \"KymFlow.app Not opened\".</p>"},{"location":"declan-getting-started/#do-this","title":"Do this","text":"<ol> <li>Download the zip into your Downloads folder</li> <li>Double-click the KymFlow.zip to extract KymFlow.app</li> <li>Open a terminal window and type (copy and paste this to get it correct)</li> </ol> <pre><code>   xattr -dr com.apple.quarantine ~/Downloads/KymFlow.app\n</code></pre> <p>After that little hoop, the app should run normally.</p> <p>If you have any problems with this, email and I will get back asap. This is a one time 'first run' thing. Next time you open (double-click), this is not needed.</p>"},{"location":"declan-getting-started/#once-the-kymflow-app-is-running","title":"Once the KymFlow app is running ...","text":"<p>Click 'open csv', find you local <code>declan-stall-v1/</code> folder and open the provided <code>declan-random-v1.csv</code></p> <p>This will populate KymFlow with 50 files for scoring.</p> <p>We are loading and analyzing a random subset of tif files specified in <code>declan-random-v1.csv</code></p> <p>You need to use 'Open CSV' and then insure you are looking at a list of 50 tif files.</p> <p>The main window will look like this:</p> <p></p>"},{"location":"declan-getting-started/#on-top-is-a-tablelist-of-all-tif-files","title":"On top is a table/list of all tif files.","text":"<p>Single click a file will:</p> <ul> <li>Display the kym image (gray)</li> <li>Display its radon velocity analysis (red)</li> <li>Populate the 'kym events'. In this example there are two 'kym events' shown in the lower table</li> </ul>"},{"location":"declan-getting-started/#to-add-your-own-user-added-events-that-will-represent-a-stall","title":"To add your own <code>User Added</code> events that will represent a stall:","text":"<ul> <li>Zoom in on the kymograph/velocity plot (mouse click + drag)</li> <li>Click 'Add Event' -&gt; select the start/stop time of the event visually (again with a click+drag in the kymograph/velocity plot)</li> <li>You will then see your new 'User Event' in the event list. User events are displayed in the velocity plot as yellow rectangles.</li> <li>The evnts you add will have <code>Type</code> 'User Added'</li> <li>You can further classify your 'User Added' events by a double-click on 'User Type' and select from: unreviewed, true_stall, reversal, other.</li> </ul>"},{"location":"declan-getting-started/#some-gui-niceties","title":"Some GUI niceties","text":"<ul> <li>Keyboard <code>enter</code> will always set the view to full scale. You can also double-click on the plot to set full scale.</li> <li>When you are zoomed in, use the '&lt;' and '&gt;' buttons to scroll throught the kymograph.</li> </ul>"},{"location":"declan-getting-started/#blind-analysis","title":"Blind analysis","text":"<p>To turn on blind analysis. Go to the options toolbar, by clicking the gear icon in the left toolbar. Click on the 'Blinded Analysis' checkbox.</p> <p>Important. Blinded analysis is a honesty contract. The gui will in general blind your analysis by not showing filenames, dates, treatments, conditions, etc. There are plenty of ways around it. Be honest!!!</p>"},{"location":"declan-getting-started/#always-save-your-work","title":"Always save your work","text":"<p>As you add user events, the top table of files will show which have been edited with a red X. </p> <p>Save all your work with 'Save All' button.</p> <p>When you quit KymFlow, you will see a warning \"Do you really want to quit?\".</p> <p>If you still need to save, click Cancel, save your work, and then quit again.</p> <p></p>"},{"location":"declan-getting-started/#what-is-next","title":"What is next","text":"<p>This is just the first step.</p> <p>Score all 50 files in <code>declan-stall-v1/</code> <code>declan-random-v1.csv</code>. Zip the <code>declan-stall-v1/</code> and put the zip into a new folder on box.</p> <p>I have scripts to test the null hypothesis, 'number of stalls is significantly different between condiitons`.</p> <p>This little tutorial is really the beginning of a lot of fun with GUIs. There is a ton more but I will leave it at that for now.</p>"},{"location":"download/","title":"Download KymFlow","text":"<p>KymFlow is available as a one-click desktop application for macOS.</p>"},{"location":"download/#system-requirements","title":"System Requirements","text":"<ul> <li>macOS: 10.13 (High Sierra) or later</li> <li>Architecture: Apple Silicon (ARM)</li> </ul>"},{"location":"download/#download","title":"Download","text":"<p>Robert will provide you with a download link ...</p> <p>The macOS application is provided as a <code>.zip</code> file containing <code>KymFlow.app</code>.</p>"},{"location":"download/#running-the-kymflow-app-macos","title":"Running the KymFlow app (macOS)","text":""},{"location":"download/#step-1-download-and-extract","title":"Step 1: Download and Extract","text":"<ol> <li>Download the <code>KymFlow.app.zip</code> file.</li> <li>Uncompress the zip file (double-click)</li> <li>You should now have a <code>KymFlow.app</code> macOS app</li> </ol>"},{"location":"download/#step-2-run-the-application-first-time","title":"Step 2: Run the Application (First Time)","text":"<p>macOS may show a warning about an \"unknown developer\" when you first try to open the app. This is normal for applications that aren't signed with an Apple Developer certificate. To run KymFlow:</p> <ol> <li>Option + Right-click (or Control + Click) on <code>KymFlow.app</code></li> <li>Select \"Open\" from the context menu</li> <li>You will see a warning dialog saying \"KymFlow is from an unidentified developer\"</li> <li>Click \"Open\" in the warning dialog</li> <li>The application will launch</li> </ol> <p>First Time Only</p> <p>You only need to do this once. After the first time, you can double-click <code>KymFlow.app</code> normally and it will open without any warnings.</p> <p>When you double-click the downloaded app, if you see this</p> <p></p> <p>Try these two things:</p> <ol> <li>option + double-click the app</li> </ol> <p>or</p> <ol> <li>option + right-click the app and select 'Open...'</li> </ol> <p></p>"},{"location":"file-formats/","title":"File Formats","text":"<p>KymFlow saves analysis results in JSON format alongside CSV data files. The JSON file contains structured metadata from three main dataclasses: <code>OlympusHeader</code>, <code>ExperimentMetadata</code>, and <code>AnalysisParameters</code>. This page documents the structure and fields of these dataclasses.</p>"},{"location":"file-formats/#json-file-structure","title":"JSON File Structure","text":"<p>When <code>KymFile.save_analysis()</code> is called, it creates a JSON file in the analysis folder (parent folder + '-analysis' suffix) with the following structure:</p> <pre><code>{\n  \"olympus_header\": { ... },\n  \"experiment_metadata\": { ... },\n  \"analysis_parameters\": { ... }\n}\n</code></pre>"},{"location":"file-formats/#experimentmetadata","title":"ExperimentMetadata","text":"<p>The <code>experiment_metadata</code> section contains user-provided experimental metadata for documenting experimental conditions, sample information, and notes. All fields are optional and have default values.</p> name display_name default_value description species Species \"\" region Region \"\" cell_type Cell type \"\" depth Depth None branch_order Branch Order None direction Direction \"\" sex Sex \"\" genotype Genotype \"\" condition Condition \"\" condition2 Condition 2 \"\" treatment Treatment \"\" treatment2 Treatment 2 \"\" date Date \"\" note Note \"\""},{"location":"file-formats/#analysisparameters","title":"AnalysisParameters","text":"<p>The <code>analysis_parameters</code> section stores information about the analysis algorithm used, its parameters, when it was run, and where results are saved. This metadata is saved alongside analysis results for reproducibility.</p> name display_name default_value description algorithm Algorithm \"\" parameters Parameters \"\" analyzed_at Analyzed At None result_path Result Path None"},{"location":"file-formats/#olympusheader","title":"OlympusHeader","text":"<p>The <code>olympus_header</code> section contains acquisition parameters extracted from the Olympus .txt header file that accompanies kymograph TIFF files. All fields have default values to handle cases where the header file is missing.</p> name display_name default_value description um_per_pixel um/pixel 1.0 seconds_per_line seconds/line 0.001 duration_seconds Duration (s) None pixels_per_line Pixels/Line None num_lines Lines None bits_per_pixel Bits/Pixel None date_str Date None time_str Time None raw Raw \"\""},{"location":"file-formats/#generating-documentation-tables","title":"Generating Documentation Tables","text":"<p>To generate the markdown tables for this documentation, run:</p> <pre><code>python scripts/generate_docs.py\n</code></pre> <p>Then copy and paste the generated tables into the appropriate sections above.</p>"},{"location":"examples/notebooks/","title":"Example Notebooks","text":"<p>Jupyter notebooks demonstrating how to use the KymFlow Python API.</p>"},{"location":"examples/notebooks/#available-notebooks","title":"Available Notebooks","text":"<p>Notebooks are located in the <code>notebooks/</code> directory of the repository:</p> <ul> <li><code>display_one_kym.py</code> - Example script for displaying a single kymograph</li> <li><code>quality_control.ipynb</code> - Quality control workflow</li> </ul>"},{"location":"examples/notebooks/#running-notebooks","title":"Running Notebooks","text":"<ol> <li> <p>Install notebook dependencies:    <pre><code>pip install kymflow[notebook]\n</code></pre></p> </li> <li> <p>Launch Jupyter Lab:    <pre><code>jupyter lab --notebook-dir notebooks\n</code></pre></p> </li> <li> <p>Open and run the notebooks to see examples of:</p> </li> <li>Loading kymograph files</li> <li>Accessing metadata</li> <li>Running flow analysis</li> <li>Visualizing results</li> </ol>"},{"location":"examples/notebooks/#example-code","title":"Example Code","text":"<pre><code>from kymflow.core.kym_file import KymFile\n\n# Load a kymograph file\nkym = KymFile(\"path/to/file.tif\", load_image=False)\n\n# Access metadata\nprint(f\"Duration: {kym.duration_seconds} seconds\")\nprint(f\"Pixels per line: {kym.pixels_per_line}\")\n\n# Load image when needed\nimage = kym.ensure_image_loaded()\n\n# Run analysis\nkym.analyze_flow(window_size=16)\n\n# Save results\nkym.save_analysis()\n</code></pre>"},{"location":"plans/error-cb-plan/","title":"Plan: Add error_cb to AcqImageList Load Pipeline","text":"<p>Implementation order: Follow the \"Files to Modify\" section in order (1 \u2192 5). Each file path is relative to the kymflow project root (the directory containing <code>src/kymflow</code> and <code>tests/</code>).</p> <p>Conventions: Add <code>error_cb</code> as an optional parameter after <code>progress_cb</code> in every signature. Use keyword-only args where the rest of the API does (e.g. after <code>*</code>). Line numbers in the plan (~L...) are approximate; use method and call-site descriptions to locate the correct spots if the code has changed.</p>"},{"location":"plans/error-cb-plan/#summary","title":"Summary","text":"<p>Add an optional <code>error_cb</code> callback to signal when individual files fail to load (e.g., permission denied on macOS). The callback mirrors <code>cancel_event</code> and <code>progress_cb</code> and allows the GUI to surface non-fatal load errors to the user.</p>"},{"location":"plans/error-cb-plan/#problem","title":"Problem","text":"<p>When loading a path (folder, file list, or CSV), <code>AcqImageList._instantiate_image()</code> constructs <code>image_cls(**kwargs)</code> (e.g., <code>KymImage(path=file_path)</code>). KymImage can fail when it calls <code>_readOlympusHeader(path_obj)</code>, which reads the companion <code>.txt</code> file via <code>with open(olympusTxtPath) as f:</code> in <code>read_olympus_header.py</code> (line 350). On some systems (e.g., macOS Sequoia) the app may lack permission, raising:</p> <pre><code>[Errno 1] Operation not permitted: '/Users/.../20251114_A114_0008.txt'\n</code></pre> <p>The exception propagates:</p> <ol> <li><code>read_olympus_header.py:350</code> \u2013 <code>open(olympusTxtPath)</code> raises <code>OSError</code></li> <li><code>_readOlympusHeader</code> \u2013 no try/except, propagates</li> <li><code>KymImage.__init__:53</code> \u2013 <code>_olympusDict = _readOlympusHeader(path_obj)</code> propagates</li> <li><code>AcqImageList._instantiate_image:303</code> \u2013 <code>return self.image_cls(**kwargs)</code> propagates</li> <li>Caught by <code>except Exception as e:</code> in <code>_instantiate_image</code> (lines 304\u2013307)</li> </ol> <p><code>_instantiate_image</code> logs the error and returns <code>None</code>. <code>_wrap_paths</code> receives <code>None</code> and skips the file. No upstream notification occurs; the user only sees logs and may not realize files were skipped.</p>"},{"location":"plans/error-cb-plan/#design","title":"Design","text":""},{"location":"plans/error-cb-plan/#error_cb","title":"error_cb","text":"<ul> <li>Signature: <code>Callable[[Path, Exception], None] | None</code></li> <li>Invocation: Called when <code>_instantiate_image</code> catches an exception, before returning <code>None</code></li> <li>Threading: Invoked on the worker thread (same as <code>progress_cb</code>); UI updates must happen elsewhere (e.g., in <code>on_done</code>)</li> </ul>"},{"location":"plans/error-cb-plan/#does-error_cb-stop-the-load","title":"Does error_cb stop the load?","text":"<p>No. <code>error_cb</code> is a reporting hook. When a file fails:</p> <ol> <li><code>_instantiate_image</code> catches the exception</li> <li>Calls <code>error_cb(file_path, e)</code> if provided</li> <li>Returns <code>None</code></li> <li><code>_wrap_paths</code> does not append the failed file but continues to the next one</li> </ol> <p>The load proceeds for all other files. Only the failed file(s) are skipped. If you want \u201cabort on first error,\u201d that would be a separate design (e.g., <code>error_cb</code> sets <code>cancel_event</code>, or returns a boolean to abort).</p>"},{"location":"plans/error-cb-plan/#where-uinotify-is-called","title":"Where ui.notify() is Called","text":"<p><code>ui.notify()</code> runs on the main thread. <code>error_cb</code> runs on the worker thread, so it should not call <code>ui.notify()</code> directly.</p> <p>The correct place for <code>ui.notify()</code> is in <code>FolderController._start_threaded_load</code> inside the <code>on_done</code> callback (around lines 266\u2013293):</p> <pre><code>def on_done(result: tuple[\"KymImageList\", Path]) -&gt; None:\n    dialog.close()\n    files, selected_path = result\n    self._app_state._apply_loaded_files(files, selected_path)\n    # ... persist config, set title, emit event ...\n\n    # Show success notification\n    try:\n        if is_csv:\n            ui.notify(f\"Loaded CSV: {path.name}\", type=\"positive\")\n        else:\n            ui.notify(f\"Loaded: {path.name}\", type=\"positive\")\n\n        # NEW: If any files failed to load, show warning\n        if load_errors:\n            ui.notify(\n                f\"{len(load_errors)} file(s) could not be loaded (e.g., permission denied)\",\n                type=\"warning\",\n            )\n    except RuntimeError as e:\n        # ... existing exception handling ...\n</code></pre> <p>Flow:</p> <ol> <li>Worker runs, calls <code>error_cb(path, exc)</code> for each failed file; <code>error_cb</code> appends to <code>load_errors</code>.</li> <li>Worker completes and puts <code>DoneMsg</code> into the queue.</li> <li>Timer on the main thread drains the queue and calls <code>on_done</code>.</li> <li><code>on_done</code> runs on the main thread \u2192 safe to call <code>ui.notify()</code>.</li> </ol> <p><code>load_errors</code> is defined in the closure around <code>worker_fn</code> / <code>on_done</code> and is populated by the worker before <code>on_done</code> runs.</p>"},{"location":"plans/error-cb-plan/#files-to-modify","title":"Files to Modify","text":"<p>All paths below are relative to the kymflow project root (e.g. <code>kymflow/</code> when you are in the repo).</p>"},{"location":"plans/error-cb-plan/#1-srckymflowcoreutilsprogresspy","title":"1. <code>src/kymflow/core/utils/progress.py</code>","text":"Location Change Imports Ensure <code>Path</code> is in scope (already used by <code>ProgressMessage</code>). After line <code>ProgressCallback = Callable[[ProgressMessage], None]</code> Add: <code>ErrorCallback = Callable[[Path, Exception], None]</code>"},{"location":"plans/error-cb-plan/#2-srckymflowcoreimage_loadersacq_image_listpy","title":"2. <code>src/kymflow/core/image_loaders/acq_image_list.py</code>","text":"Location Change Imports Add <code>ErrorCallback</code> to the import from <code>kymflow.core.utils.progress</code>. <code>__init__</code> (signature ~L79\u201381) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> into both <code>_load_files(...)</code> calls (file_path_list branch ~L151\u2013155, path branch ~L177\u2013181). <code>_load_files</code> (signature ~L312\u2013315) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> into every <code>_wrap_paths(...)</code> call (3 places: ~L322\u2013326, ~L343\u2013347, ~L367\u2013374). <code>_wrap_paths</code> (signature ~L690\u2013696) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. In the loop, change <code>_instantiate_image(file_path, blind_index=index)</code> to <code>_instantiate_image(file_path, blind_index=index, error_cb=error_cb)</code>. <code>_instantiate_image</code> (signature ~L283) Add parameter <code>error_cb: ErrorCallback \\| None = None</code> (after <code>blind_index</code>). In the <code>except Exception as e:</code> block, before <code>return None</code>, add: <code>if error_cb is not None: error_cb(file_path, e)</code>. (Keep existing <code>logger.error</code> calls; call <code>error_cb</code> before <code>return None</code>.) <code>load</code> (signature ~L378\u2013384) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> to <code>_load_files(...)</code> (~L399\u2013403). <code>reload</code> (signature ~L405\u2013410) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> to <code>load(...)</code> (~L413\u2013417). <code>load_from_path</code> (signature ~L428\u2013439) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> into each of the four <code>return cls(...)</code> calls only (do not add error_cb to <code>collect_paths_from_csv</code>). Exact call sites: (1) path=None branch: <code>return cls(path=None, ..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L453\u2013461). (2) CSV branch: <code>return cls(file_path_list=..., ..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L471\u2013479). (3) Single-file branch: <code>return cls(path=path_obj, ..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L482\u2013490). (4) Folder branch: <code>return cls(path=path_obj, ..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L493\u2013502)."},{"location":"plans/error-cb-plan/#3-srckymflowcoreimage_loaderskym_image_listpy","title":"3. <code>src/kymflow/core/image_loaders/kym_image_list.py</code>","text":"Location Change Imports Add <code>ErrorCallback</code> to the import from <code>kymflow.core.utils.progress</code> (same line as <code>CancelledError</code>, <code>ProgressCallback</code>, <code>ProgressMessage</code>). <code>__init__</code> (signature ~L78\u201380) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> in <code>super().__init__(..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L104\u2013115). <code>load_from_path</code> (signature ~L136\u2013139) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> in every <code>return cls(...)</code>: (1) path=None branch (~L164\u2013166), (2) CSV branch (~L174\u2013181), (3) single-file branch (~L184\u2013191), (4) folder branch (~L193\u2013200)."},{"location":"plans/error-cb-plan/#4-srckymflowgui_v2statepy","title":"4. <code>src/kymflow/gui_v2/state.py</code>","text":"Location Change Imports Add <code>ErrorCallback</code> to the import from <code>kymflow.core.utils.progress</code> (e.g. <code>from kymflow.core.utils.progress import ProgressCallback, ErrorCallback</code>). <code>_build_files_for_path</code> (signature ~L153\u2013161) Add <code>error_cb: ErrorCallback \\| None = None</code> after <code>progress_cb</code>. Pass <code>error_cb=error_cb</code> into <code>KymImageList.load_from_path(..., progress_cb=progress_cb, error_cb=error_cb)</code> (~L175\u2013182)."},{"location":"plans/error-cb-plan/#5-srckymflowgui_v2controllersfolder_controllerpy","title":"5. <code>src/kymflow/gui_v2/controllers/folder_controller.py</code>","text":"Location Change <code>_start_threaded_load</code> Before defining <code>worker_fn</code>, define <code>load_errors: list[tuple[Path, Exception]] = []</code> and <code>def capture_error(path: Path, exc: Exception) -&gt; None: load_errors.append((path, exc))</code>. At start of <code>worker_fn</code>, add <code>load_errors.clear()</code>. Pass <code>error_cb=capture_error</code> into <code>_build_files_for_path(...)</code>. Inside <code>on_done</code>, after the existing success <code>ui.notify</code> block (and inside the same <code>try</code>), add: <code>if load_errors: ui.notify(f\"{len(load_errors)} file(s) could not be loaded (e.g., permission denied)\", type=\"warning\")</code>. <p>Worker closure sketch:</p> <pre><code>load_errors: list[tuple[Path, Exception]] = []\n\ndef capture_error(path: Path, exc: Exception) -&gt; None:\n    load_errors.append((path, exc))\n\ndef worker_fn(cancel_event, progress_cb):\n    load_errors.clear()\n    result = self._app_state._build_files_for_path(\n        path,\n        depth=depth,\n        cancel_event=cancel_event,\n        progress_cb=progress_cb,\n        error_cb=capture_error,\n    )\n    # ...\n</code></pre>"},{"location":"plans/error-cb-plan/#tests","title":"Tests","text":"<p>Add tests in <code>tests/core/test_acq_image_list.py</code>:</p> <ul> <li><code>error_cb</code> is called when <code>_instantiate_image</code> fails (e.g. mock <code>image_cls</code> to raise).</li> <li><code>error_cb</code> is not called when load succeeds.</li> <li>Load continues after a failure; other files are still loaded.</li> </ul>"},{"location":"plans/error-cb-plan/#implementation-checklist-run-in-order","title":"Implementation checklist (run in order)","text":"<ol> <li>progress.py \u2013 Add <code>ErrorCallback</code> type alias.</li> <li>acq_image_list.py \u2013 Import <code>ErrorCallback</code>; add <code>error_cb</code> param to <code>__init__</code>, <code>_load_files</code>, <code>_wrap_paths</code>, <code>_instantiate_image</code>, <code>load</code>, <code>reload</code>, <code>load_from_path</code>; thread through all call sites; in <code>_instantiate_image</code> except block call <code>error_cb(file_path, e)</code> when <code>error_cb</code> is not None.</li> <li>kym_image_list.py \u2013 Import <code>ErrorCallback</code>; add <code>error_cb</code> to <code>__init__</code> and <code>load_from_path</code>; pass through to <code>super().__init__</code> and all <code>cls(...)</code> returns.</li> <li>state.py \u2013 Import <code>ErrorCallback</code>; add <code>error_cb</code> to <code>_build_files_for_path</code> and pass to <code>KymImageList.load_from_path</code>.</li> <li>folder_controller.py \u2013 In <code>_start_threaded_load</code>: add <code>load_errors</code> and <code>capture_error</code>; pass <code>error_cb=capture_error</code> to <code>_build_files_for_path</code>; in <code>on_done</code> add <code>ui.notify</code> when <code>load_errors</code> is non-empty.</li> <li>tests \u2013 Add tests in <code>tests/core/test_acq_image_list.py</code> as above.</li> </ol>"},{"location":"plans/error-cb-plan/#out-of-scope","title":"Out of Scope","text":"<ul> <li>Changing <code>read_olympus_header.py</code> to catch/handle permission errors locally (current design: let exceptions propagate to <code>_instantiate_image</code>)</li> <li>Aborting the load on first error (would require an additional design decision)</li> <li>ThreadJobRunner changes (worker still receives only <code>cancel_event</code> and <code>progress_cb</code>; <code>error_cb</code> is captured in the closure)</li> </ul>"},{"location":"user-guide/batch-processing/","title":"Batch Processing","text":"<p>Batch processing allows you to analyze multiple kymograph files sequentially with progress tracking.</p>"},{"location":"user-guide/batch-processing/#workflow","title":"Workflow","text":"<ol> <li>Navigate to Batch Page: Click \"Batch\" in the header navigation</li> <li>Select Files:</li> <li>Click multiple rows to select files (multi-select mode)</li> <li>Selection counter shows number of selected files</li> <li>Set Parameters: Choose window size for analysis</li> <li>Start Analysis: Click \"Analyze Flow\" button</li> <li>Monitor Progress:</li> <li>Overall progress shows files completed</li> <li>Per-file progress shows windows completed for current file</li> <li>Save Results: Files are marked as analyzed; use Save button to persist</li> </ol>"},{"location":"user-guide/batch-processing/#features","title":"Features","text":"<ul> <li>Progress Tracking: Two progress bars - one for overall batch, one for current file</li> <li>Cancellation: Cancel button stops processing at any time</li> <li>Auto-Refresh: File table updates as each file completes</li> <li>Error Handling: If one file fails, processing continues with remaining files</li> </ul>"},{"location":"user-guide/batch-processing/#tips","title":"Tips","text":"<ul> <li>Start with a small selection to test parameters</li> <li>Window size applies to all files in the batch</li> <li>Results are not auto-saved - use Save button after batch completes</li> <li>Large batches may take significant time depending on file sizes</li> </ul>"},{"location":"user-guide/getting-started/","title":"Getting Started","text":""},{"location":"user-guide/getting-started/#first-steps","title":"First Steps","text":"<ol> <li>Launch KymFlow: Run <code>kymflow-gui</code> from your terminal</li> <li>Select a Folder: Use the folder selector to choose a directory containing kymograph TIFF files</li> <li>Browse Files: The file table shows all TIFF files found in the selected folder</li> <li>Select a File: Click on a file in the table to view its metadata and image</li> </ol>"},{"location":"user-guide/getting-started/#basic-workflow","title":"Basic Workflow","text":""},{"location":"user-guide/getting-started/#viewing-files","title":"Viewing Files","text":"<ul> <li>The file table displays key metadata for each file</li> <li>Select a file to see detailed metadata, image, and analysis results</li> <li>Use the image viewer to explore the kymograph data</li> </ul>"},{"location":"user-guide/getting-started/#editing-metadata","title":"Editing Metadata","text":"<ol> <li>Select a file from the table</li> <li>Edit fields in the Metadata section (species, region, notes, etc.)</li> <li>Changes are saved automatically when you save the analysis</li> </ol>"},{"location":"user-guide/getting-started/#running-analysis","title":"Running Analysis","text":"<ol> <li>Select a file</li> <li>Set the window size (typically 16, 32, 64, 128, or 256)</li> <li>Click \"Analyze Flow\" in the toolbar</li> <li>Wait for analysis to complete</li> <li>Click \"Save\" to persist results</li> </ol>"},{"location":"user-guide/getting-started/#batch-processing","title":"Batch Processing","text":"<ol> <li>Navigate to the Batch page</li> <li>Select multiple files (hold Ctrl/Cmd to multi-select)</li> <li>Set window size</li> <li>Click \"Analyze Flow\" to process all selected files sequentially</li> </ol>"},{"location":"user-guide/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>See GUI Usage for detailed interface documentation</li> <li>See Batch Processing for batch analysis workflows</li> <li>See API Reference for programmatic access</li> </ul>"},{"location":"user-guide/gui-usage/","title":"GUI Usage Guide","text":""},{"location":"user-guide/gui-usage/#main-page","title":"Main Page","text":"<p>The main page provides a complete workflow for analyzing individual kymograph files.</p>"},{"location":"user-guide/gui-usage/#file-table","title":"File Table","text":"<ul> <li>Single Selection: Click a row to select a file</li> <li>Columns: File name, folder info, analysis status, metadata preview</li> <li>Status Indicators: \u2713 marks show if file is analyzed and saved</li> </ul>"},{"location":"user-guide/gui-usage/#image-line-viewer","title":"Image &amp; Line Viewer","text":"<ul> <li>Kymograph Display: Shows the 2D kymograph image</li> <li>Line Plot: Shows velocity over time from analysis</li> <li>Zoom/Pan: Use mouse to zoom and pan the image</li> <li>Contrast Controls: Adjust intensity scaling</li> </ul>"},{"location":"user-guide/gui-usage/#metadata-forms","title":"Metadata Forms","text":"<ul> <li>Experimental Metadata: Edit species, region, cell type, depth, branch order, direction, sex, genotype, condition, and notes</li> <li>Olympus Header: View acquisition parameters (read-only)</li> <li>Analysis Parameters: View analysis settings and results (read-only)</li> </ul>"},{"location":"user-guide/gui-usage/#analysis-toolbar","title":"Analysis Toolbar","text":"<ul> <li>Window Size: Select analysis window size (16, 32, 64, 128, 256)</li> <li>Analyze Flow: Run Radon-based flow analysis</li> <li>Cancel: Stop running analysis</li> <li>Save: Save analysis results to disk</li> </ul>"},{"location":"user-guide/gui-usage/#batch-page","title":"Batch Page","text":"<p>The batch page allows processing multiple files sequentially.</p>"},{"location":"user-guide/gui-usage/#multi-selection","title":"Multi-Selection","text":"<ul> <li>Select Multiple Files: Click multiple rows to select them</li> <li>Selection Counter: Shows number of selected files</li> <li>Analyze Selected: Process only selected files</li> <li>Progress Tracking: See progress for both individual files and overall batch</li> </ul>"},{"location":"user-guide/gui-usage/#batch-controls","title":"Batch Controls","text":"<ul> <li>Window Size: Set analysis window size for all files</li> <li>Analyze Flow: Start batch processing</li> <li>Cancel: Stop batch processing at any time</li> </ul>"},{"location":"user-guide/gui-usage/#tips","title":"Tips","text":"<ul> <li>Use the folder selector to switch between different data directories</li> <li>Analysis results are saved in a <code>-analysis</code> subfolder alongside your TIFF files</li> <li>The GUI preserves your file selections when navigating between pages</li> <li>Use the contrast controls to better visualize flow patterns in the image</li> </ul>"},{"location":"user-guide/installation/","title":"Installation","text":""},{"location":"user-guide/installation/#quick-start","title":"Quick Start","text":""},{"location":"user-guide/installation/#create-virtual-environment","title":"Create Virtual Environment","text":"<pre><code>python -m venv venv\n</code></pre>"},{"location":"user-guide/installation/#activate-virtual-environment","title":"Activate Virtual Environment","text":"<p>On macOS/Linux: <pre><code>source venv/bin/activate\n</code></pre></p> <p>On Windows: <pre><code>venv\\Scripts\\activate\n</code></pre></p>"},{"location":"user-guide/installation/#install-kymflow-with-gui","title":"Install KymFlow with GUI","text":"<pre><code>pip install kymflow[gui]\n</code></pre>"},{"location":"user-guide/installation/#run-the-gui","title":"Run the GUI","text":"<pre><code>kymflow-gui\n</code></pre> <p>The GUI will open in your default web browser at <code>http://localhost:8080</code> (or the next available port).</p>"},{"location":"user-guide/installation/#installation-options","title":"Installation Options","text":""},{"location":"user-guide/installation/#gui-application-only","title":"GUI Application Only","text":"<pre><code>pip install kymflow[gui]\n</code></pre>"},{"location":"user-guide/installation/#python-api-only-no-gui","title":"Python API Only (No GUI)","text":"<pre><code>pip install kymflow\n</code></pre>"},{"location":"user-guide/installation/#development-installation","title":"Development Installation","text":"<p>For development, install in editable mode with all extras:</p> <pre><code>git clone https://github.com/mapmanager/kymflow.git\ncd kymflow\npip install -e \".[gui,test,notebook]\"\n</code></pre>"},{"location":"user-guide/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>See <code>pyproject.toml</code> for full dependency list</li> </ul>"}]}